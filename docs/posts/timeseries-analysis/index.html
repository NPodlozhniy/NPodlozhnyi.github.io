<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Time Series Analysis in Python | Nikita Podlozhniy</title>
<meta name="keywords" content="">
<meta name="description" content="Intro It&rsquo;s a short yet handy guide on how to analyze time series data in a few clicks using modern Python libraries.
Tech stack for this guide consists of
duckdb and pandas packages for data processing Facebook&rsquo;s prophet for data exploration and forecasting plotly for data visualization Codeimport duckdb as db import pandas as pd import numpy as np orders = pd.read_csv(&#39;orders_data.csv&#39;) orders.sample() Created Date Country City Restaurant ID Restaurant Name Order State Cancel Reason Cuisine Platform Products in Order Order Value € (Gross) Delivery Fee Delivery Time Order ID 44255 10.">
<meta name="author" content="Nikita Podlozhniy">
<link rel="canonical" href="https://npodlozhniy.github.io/posts/timeseries-analysis/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://npodlozhniy.github.io/favicons/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://npodlozhniy.github.io/favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://npodlozhniy.github.io/favicons/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://npodlozhniy.github.io/favicons/apple-touch-icon.png">
<link rel="mask-icon" href="https://npodlozhniy.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://npodlozhniy.github.io/posts/timeseries-analysis/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body, 
    {
              delimiters: [
                  {left: '$$', right: '$$', display: true},
                  {left: '\\[', right: '\\]', display: true},
                  {left: '$', right: '$', display: false},
                  {left: '\\(', right: '\\)', display: false}
              ]
          }
    );"></script>



<script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-ESWD18X008"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-ESWD18X008', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Time Series Analysis in Python" />
<meta property="og:description" content="Intro It&rsquo;s a short yet handy guide on how to analyze time series data in a few clicks using modern Python libraries.
Tech stack for this guide consists of
duckdb and pandas packages for data processing Facebook&rsquo;s prophet for data exploration and forecasting plotly for data visualization Codeimport duckdb as db import pandas as pd import numpy as np orders = pd.read_csv(&#39;orders_data.csv&#39;) orders.sample() Created Date Country City Restaurant ID Restaurant Name Order State Cancel Reason Cuisine Platform Products in Order Order Value € (Gross) Delivery Fee Delivery Time Order ID 44255 10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://npodlozhniy.github.io/posts/timeseries-analysis/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-09-02T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Time Series Analysis in Python"/>
<meta name="twitter:description" content="Intro It&rsquo;s a short yet handy guide on how to analyze time series data in a few clicks using modern Python libraries.
Tech stack for this guide consists of
duckdb and pandas packages for data processing Facebook&rsquo;s prophet for data exploration and forecasting plotly for data visualization Codeimport duckdb as db import pandas as pd import numpy as np orders = pd.read_csv(&#39;orders_data.csv&#39;) orders.sample() Created Date Country City Restaurant ID Restaurant Name Order State Cancel Reason Cuisine Platform Products in Order Order Value € (Gross) Delivery Fee Delivery Time Order ID 44255 10."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://npodlozhniy.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Time Series Analysis in Python",
      "item": "https://npodlozhniy.github.io/posts/timeseries-analysis/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Time Series Analysis in Python",
  "name": "Time Series Analysis in Python",
  "description": "Intro It\u0026rsquo;s a short yet handy guide on how to analyze time series data in a few clicks using modern Python libraries.\nTech stack for this guide consists of\nduckdb and pandas packages for data processing Facebook\u0026rsquo;s prophet for data exploration and forecasting plotly for data visualization Code\rimport duckdb as db import pandas as pd import numpy as np orders = pd.read_csv(\u0026#39;orders_data.csv\u0026#39;) orders.sample() Created Date Country City Restaurant ID Restaurant Name Order State Cancel Reason Cuisine Platform Products in Order Order Value € (Gross) Delivery Fee Delivery Time Order ID 44255 10.",
  "keywords": [
    
  ],
  "articleBody": "\rIntro It’s a short yet handy guide on how to analyze time series data in a few clicks using modern Python libraries.\nTech stack for this guide consists of\nduckdb and pandas packages for data processing Facebook’s prophet for data exploration and forecasting plotly for data visualization Code\rimport duckdb as db import pandas as pd import numpy as np orders = pd.read_csv('orders_data.csv') orders.sample() Created Date Country City Restaurant ID Restaurant Name Order State Cancel Reason Cuisine Platform Products in Order Order Value € (Gross) Delivery Fee Delivery Time Order ID 44255 10.01.2020 Portugal Lisbon 6167 H3 Armazéns do Chiado delivered NaN Mediterranean ios 1 €9.55 0.0 14.7 379143844 Are there any discernible patterns or seasonality present? Usually it’s good to start any time series analysis with tackling four key questions:\nIs there any trend? Is there seasonality, if so which type: additive or multiplicative? Is there any explicit change points, which we should consider? Are there outliers? - Get rid of them! Data If you never experienced duckdb before, I totally recommend you to try as it boosts your efficiency allowing simultaneous usage of best features from Python and SQL\nCode\rdf = db.query(\"\"\" SELECT strptime(\"Created Date\", '%d.%m.%Y') as date ,\"City\" as city ,count(*) as orders FROM orders o WHERE \"Order State\" = 'delivered' GROUP BY 1, 2 \"\"\").to_df() pivot = df.pivot(index='date', columns='city', values='orders') pivot.head() city Accra Lisbon date 2020-01-01 124 882 2020-01-02 126 1104 2020-01-03 76 1110 2020-01-04 169 784 2020-01-05 198 788 Code\rprint(f\"We have data for {pivot.shape[0]} consecutive days\") We have data for 59 consecutive days\rLibraries I’m using my own time series model wrappers to explore and forecast the data, they are based upon popular libraries from big tech companies, in this particular case, on Facebook Prophet\nCode\rimport datetime import re from typing import Optional, List, Tuple from plotly import express, graph_objects from plotly.subplots import make_subplots from prophet import Prophet as FP from prophet.utilities import regressor_coefficients from sklearn.preprocessing import MinMaxScaler Code\rclass ModelWrapper: \"\"\" Custom Wrapper for popular models for TimeSeries analysis, including but not limited to: - Google Causal Impact https://pypi.org/project/causalimpact/ - Facebook Prophet https://facebook.github.io/prophet/ Parameters ---------- df: DataFrame containg target variable with `y` name and time frame variable with `date` name start_date: the start date of experiment with the format YYYY-MM-DD test_days: the number of last days in which the experiment was run end_date: the end date of experiment with the format YYYY-MM-DD date: timeframe column name y: target column name Attributes ---------- explore: the chart exploring pre-experiment correlations show: visualization of the trained model, please notet that you need to run the model first \"\"\" def __init__( self, df: pd.DataFrame, start_date: Optional[str] = None, test_days: Optional[int] = None, end_date: Optional[str] = None, date: str = \"date\", y: str = \"y\" ) -\u003e None: self.df = df.copy() self.date = date self.y = y if start_date: self.start_dt = datetime.datetime.strptime(start_date, \"%Y-%m-%d\").date() elif test_days: if pd.core.dtypes.common.is_datetime64_dtype(self.df[self.date].dtype): self.start_dt = self.df[self.date].max().date() - datetime.timedelta(days=test_days) else: self.start_dt = datetime.datetime.strptime(self.df[self.date].max(), \"%Y-%m-%d\").date() - datetime.timedelta(days=test_days) else: raise ValueError(\"You must specify start_date or test_days variable\") self.end_dt = datetime.datetime.strptime(end_date, \"%Y-%m-%d\").date() if end_date else None self.x = list(self.df.columns.difference([self.date, self.y]).values) self._preprocess() def _preprocess(self): self.df[self.date] = pd.to_datetime(self.df[self.date]).dt.date self.df = self.df[[self.y, self.date] + self.x].set_index(self.date).sort_index() for column in self.df.columns[self.df.dtypes == \"object\"]: try: self.df[column] = self.df[column].astype(float) except ValueError: raise ValueError(\"All DataFrame columns except Date must be numeric\") @staticmethod def _save(figure, title: str) -\u003e None: figure.write_html( re.sub('[-:\u003c\u003e|\\/\\*\\?\\\"\\\\\\\\ ]+', '_', title.lower()) + \".html\" ) def explore( self, scale: bool = True, title: str = \"pre-experiment correlation\", x_label: Optional[str] = None, y_label: Optional[str] = None, width: int = 900, height: int = 600, save: bool = False, ) -\u003e None: \"\"\" Plot the dynamic of pre-experiment correlation Parameters ---------- scale: whether the samples should be scaled to [0, 1] interval title: the title of the chart x_label: label for X axis y_label: label for Y axis width: the width of the chart height: the height of the chart save: whether you want to save the chart as HTML \"\"\" data = self.df.copy() if scale: scaler = MinMaxScaler(feature_range=(0, 1)) data[data.columns] = scaler.fit_transform(data) corr = data[data.index \u003c self.start_dt].corr().iloc[0, 1:] data = pd.melt( data, value_vars=list(data.columns), var_name=\"variable\", value_name=\"value\", ignore_index=False, ) chart_title = title + f\"\"\"\n{', '.join( [f\"{feature}: {round(value, 2)}\" for feature, value in zip(self.x, corr)] )}\"\"\" figure = express.line( data, x=data.index, y=\"value\", color=\"variable\", height=height, width=width, title=chart_title, ) figure.add_vline(x=self.start_dt, line_width=2, line_dash=\"dash\", line_color=\"white\") if self.end_dt: figure.add_vline(x=self.end_dt, line_width=2, line_dash=\"dash\", line_color=\"white\") figure.update_traces(hovertemplate=\"%{y}\") figure.update_xaxes(title_text=x_label if x_label else \"Date\") figure.update_yaxes(title_text=y_label if y_label else \"Scaled Axis\" if scale else \"Original Axis\") figure.update_layout( title={ \"x\": 0.5, }, legend={ \"x\": 0.05, \"y\": 1.05, \"orientation\": \"h\", \"title\": None }, hovermode=\"x\", template=\"plotly_dark\", xaxis=dict(hoverformat=\"%a, %b %d, %Y\"), ) if save: self._save(figure, title) figure.show() @staticmethod def _add_chart( figure, data: pd.DataFrame, titles: list, y: str, name: str, row: int, actual: bool = False, y_label: Optional[str] = None, ) -\u003e None: figure.add_trace( graph_objects.Scatter( x=data.index, y=data[y], name=name, hovertemplate=\"%{y}\", line={\"color\": \"white\"}, legendgroup=f\"{row}\", legendgrouptitle={\"text\": titles[row]}, connectgaps=True, ), row=row, col=1, ) figure.add_trace( graph_objects.Scatter( x=data.index, y=data[y + \"_upper\"], name=\"Upper bound\", hovertemplate=\"%{y}\", line={\"color\": \"deepskyblue\", \"width\": 0.5}, legendgroup=f\"{row}\", connectgaps=True, ), row=row, col=1, ) figure.add_trace( graph_objects.Scatter( x=data.index, y=data[y + \"_lower\"], name=\"Lower bound\", hovertemplate=\"%{y}\", fill=\"tonexty\", line={\"color\": \"deepskyblue\", \"width\": 0.5}, legendgroup=f\"{row}\", connectgaps=True, ), row=row, col=1, ) figure.update_yaxes(title_text=\"\" if not y_label else \"% Effect\" if row == 4 else y_label) if actual: figure.add_trace( graph_objects.Scatter( x=data.index, y=data[\"response\"], name=\"Actual\", hovertemplate=\"%{y}\", line={\"color\": \"red\"}, legendgroup=f\"{row}\", connectgaps=True, ), row=row, col=1, ) else: figure.add_hline(y=0, line_width=1, line_color=\"white\", row=row, col=1) def show( self, keep_n_prior_days: Optional[int] = None, title: str = \"Causal Impact\", x_label: Optional[str] = None, y_label: Optional[str] = None, width: int = 900, height: int = 600, save: bool = False, ) -\u003e None: \"\"\" Plot the trained model results Parameters ---------- keep_n_prior_days: specify the exact number of pre-experiment days you want to keep, skip if you want to show all the time frame title: the title of the chart x_label: label for X axis y_label: label for Y axis width: the width of the chart height: the height of the chart save: whether you want to save the chart as HTML \"\"\" try: if keep_n_prior_days: data = self.result[ self.result.index \u003e self.start_dt - datetime.timedelta(days=keep_n_prior_days) ] else: data = self.result.iloc[1:] except AttributeError: raise AttributeError(\"To show the results run the model first, use .run() method\") titles = [ \"Model Overview\", \"Actual vs Expected\", \"Effect Size: Actual - Expected\", \"Cumulative Effect\", \"Effect Relative to Expected\", ] if isinstance(self, CausalImpact): figure = make_subplots( rows=4, cols=1, shared_xaxes=True, subplot_titles=titles[1:] ) for y, name, row in zip( [\"point_pred\", \"point_effect\", \"cum_effect\", \"rel_effect\"], [\"Expected Values\", \"Effect Size\", \"Cumulative Effect\", \"Relative Effect\"], range(1, 5) ): self._add_chart( figure, data, titles, y=y, name=name, row=row, actual=(row == 1), y_label=y_label ) elif isinstance(self, Prophet): row = 1 figure = make_subplots() self._add_chart( figure, data, titles, y=\"yhat\", name=\"Expected Value\", row=row, actual=True, y_label=y_label ) figure.update_xaxes(title_text=x_label if x_label else \"Date\", row=row, col=1) figure.add_vline(x=self.start_dt, line_width=2, line_dash=\"dash\", line_color=\"white\") if self.end_dt: figure.add_vline(x=self.end_dt, line_width=2, line_dash=\"dash\", line_color=\"white\") figure.update_layout( title={ \"x\": 0.5, \"text\": title, }, width=width, height=height, hovermode=\"x\", template=\"plotly_dark\", legend={ \"x\": 0.0, \"y\": -0.2, \"orientation\": \"h\", \"groupclick\": \"toggleitem\", \"traceorder\": \"grouped\", }, xaxis=dict(hoverformat=\"%a, %b %d, %Y\"), ) if save: self._save(figure, title) figure.show() Code\rclass CausalImpact(ModelWrapper): def run( self, nseasons: int = 7, season_duration: int = 1, alpha: float = 0.05, **kwargs ) -\u003e pd.DataFrame: \"\"\" Run causal impact analysis Parameters ---------- nseasons: Period of the seasonal components. In order to include a seasonal component, set this to a whole number greater than 1. For example, if the data represent daily observations, use 7 for a day-of-week component. This interface currently only supports up to one seasonal component. season_duration: Duration of each season, i.e., number of data points each season spans. For example, to add a day-of-week component to data with daily granularity, use model_args = list(nseasons = 7, season_duration = 1). To add a day-of-week component to data with hourly granularity, set model_args = list(nseasons = 7, season_duration = 24). alpha : Desired tail-area probability for posterior intervals. Defaults to 0.05, which will produce central 95% intervals Other Parameters ---------------- **kwargs : model_args variables, available options: ndraws: number of MCMC samples to draw. More samples lead to more accurate inferences. Defaults to 1000. nburn: number of burn in samples. This specifies how many of the initial samples will be discarded. defaults to 10% of ndraws. standardize_data: whether to standardize all columns of the data before fitting the model. This is equivalent to an empirical Bayes approach to setting the priors. It ensures that results are invariant to linear transformations of the data. prior_level_sd: prior standard deviation of the Gaussian random walk of the local level. Expressed in terms of data standard deviations. Defaults to 0.01. A typical choice for well-behaved and stable datasets with low residual volatility after regressing out known predictors. When in doubt, a safer option is to use 0.1, as validated on synthetic data, although this may sometimes give rise to unrealistically wide prediction intervals. dynamic_regression: whether to include time-varying regression coefficients. In combination with a time-varying local trend or even a time-varying local level, this often leads to overspecification, in which case a static regression is safer. Defaults to FALSE. \"\"\" data = self.df.copy().reset_index() prior = [ data.index.min(), int(data[data[self.date] \u003c self.start_dt].index.max()) ] posterior = [ int(data[data[self.date] \u003e= (self.end_dt if self.end_dt else self.start_dt)].index.min()), data.index.max() ] data.drop(columns=[self.date], inplace=True) self.ci = CI( data, prior, posterior, model_args={ \"nseasons\": nseasons, \"season_duration\": season_duration, **kwargs }, alpha=alpha, ) self.ci.run() def summary(self, format: str = \"summary\") -\u003e None: \"\"\" Print the summary for Causal Impact Analysis model Parameters ---------- format: can be 'summary' to return a table or 'report' to return a natural language description \"\"\" try: self.ci.summary(format) except AttributeError: raise AttributeError(\"To get the summary run the model first, use .run() method\") self.result = self.ci.inferences.set_index(self.df.index) for suffix in [\"\", \"_lower\", \"_upper\"]: self.result[\"rel_effect\" + suffix] = self.result[\"point_effect\" + suffix] / self.result[\"point_pred\"] Code\rclass Prophet(ModelWrapper): def run( self, growth: str = \"linear\", weekly_seasonality: bool = True, monthly_seasonality: bool = True, yearly_seasonality: bool = True, seasonality_mode: str = \"additive\", country_holidays: Optional[str] = None, outliers: Optional[List[Tuple[str]]] = None, floor: Optional[int] = None, cap: Optional[int] = None, alpha: float = 0.05, **kwargs, ) -\u003e pd.DataFrame: \"\"\" Run time-series forecasting Parameters ---------- growth: String 'linear', 'logistic' or 'flat' to specify a linear, logistic or flat trend. weekly_seasonality: Fit weekly seasonality. monthly_seasonality: Fit monthly seasonality. yearly_seasonality: Fit yearly seasonality. seasonality_mode: 'additive' (default) or 'multiplicative'. country_holidays: country code (e.g. 'RU') of the country whose holiday are to be considered outliers: list of time intervals (start date, end date) with the format YYYY-MM-DD where there are outliers floor: minimum allowed value for the target variable. It's particulary useful with \"logistic\" growth type cap: maximum allowed value for the target variable. It's particulary useful with \"logistic\" growth type alpha: 1 - width of the uncertainty intervals provided for the forecast. Other Parameters ---------------- **kwargs : model_args variables, to reveal the whole list follow the Prophet documentation, for example: n_changepoints: Number of potential changepoints to include. Not used if input `changepoints` is supplied. If `changepoints` is not supplied, then n_changepoints potential changepoints are selected uniformly from the first `changepoint_range` proportion of the history. changepoint_range: Proportion of history in which trend changepoints will be estimated. Defaults to 0.8 for the first 80%. Not used if `changepoints` is specified. changepoint_prior_scale: Parameter modulating the flexibility of the automatic changepoint selection. Large values will allow many changepoints, small values will allow few changepoints. \"\"\" data = self.df.copy().reset_index().rename(columns={self.date: \"ds\", self.y: \"y\"}).sort_values(\"ds\") if cap: data[\"cap\"] = cap if floor: data[\"floor\"] = floor train, test = data[data[\"ds\"] \u003c self.start_dt], data[data[\"ds\"] \u003e= self.start_dt] self.model = FP( growth=growth, weekly_seasonality=weekly_seasonality, yearly_seasonality=yearly_seasonality, seasonality_mode=seasonality_mode, interval_width=1-alpha, **kwargs, ) if monthly_seasonality: self.model.add_seasonality(name=\"monthly\", period=30.5, fourier_order=5) if country_holidays: self.model.add_country_holidays(country_name=country_holidays) if outliers: for pair in outliers: train.loc[ (train[\"ds\"] \u003e datetime.datetime.strptime(pair[0], \"%Y-%m-%d\").date()) \u0026 (train[\"ds\"] \u003c datetime.datetime.strptime(pair[1], \"%Y-%m-%d\").date()), \"y\"] = None for feature in self.x: self.model.add_regressor(feature) self.model.fit(train) future = self.model.make_future_dataframe(periods=test.shape[0]) self.result = self.model.predict(future.set_index(\"ds\").join(data.set_index(\"ds\")).reset_index()) self.result[\"ds\"] = self.result[\"ds\"].dt.date self.result = self.result.set_index(\"ds\").join(data[[\"ds\", \"y\"]].set_index(\"ds\")).rename(columns={\"y\": \"response\"}) def summary( self, width: int = 900, height: int = 600, save: bool = False, ) -\u003e pd.DataFrame: \"\"\" Plot the regressors statistics: Coefficients, Impact and Impact Share The estimated beta coefficient for each regressor roughly represents the increase in prediction value for a unit increase in the regressor value. Note that the coefficients returned are always on the scale of the original data In addition the credible interval for each coefficient is also returned, which can help identify whether each regressor is “statistically significant”. On the basis of `seasonality_mode` the model looks like: Additive: y(t) ~ trend(t) + seasonality(t) + beta * regressor(t) Multiplicative: y(t) ~ trend(t) * ( 1 + seasonality(t) + beta * regressor(t) ) Therefore, the incremental impact are: Additive: increasing the value of the regressor by a unit leads to an increase in y(t) by beta units Multiplicative: increasing the value of the regressor by a unit leads to increase in y(t) by beta * trend(t) units The Impact is the product of incremental impact(t) * regressor(t) and finally, Share is the percentage of absolute Impact Parameters ---------- width: the width of the chart height: the height of the chart save: whether you want to save the chart as HTML \"\"\" try: data = regressor_coefficients(self.model) except AttributeError: raise AttributeError(\"To get the summary run the model first, use .run() method\") last_day_data, last_day_result = self.df.iloc[-1, :], self.result.iloc[-1, :] data[\"incremental_impact\"] = data[\"coef\"] * data[\"regressor_mode\"].apply(lambda x: last_day_result[\"trend\"] if x == \"multiplicative\" else 1) data[\"impact\"] = data.apply(lambda x: x[\"incremental_impact\"] * last_day_data[x[\"regressor\"]], axis=1) data[\"share\"] = round(100 * np.abs(data[\"impact\"]) / np.sum(np.abs(data[\"impact\"])), 2) def plot_bar(data, y, title): figure = express.bar( data, x=\"regressor\", y=y, color=\"regressor\", color_discrete_sequence=express.colors.sequential.Jet, ) figure.add_hline(y=0, line_width=1, line_color=\"white\") figure.update_xaxes(title_text=None) figure.update_layout( title={ \"x\": 0.5, \"text\": title, }, width=width, height=height, hovermode=\"x\", template=\"plotly_dark\", showlegend=False, ) if save: self._save(figure, title) figure.show() for y, title in zip([\"coef\", \"impact\"], [\"Coefficients\", \"Impact\"]): plot_bar(data.sort_values(by=\"coef\", ascending=False), y, title) pie = express.pie( data.sort_values(by=\"coef\", ascending=False), color_discrete_sequence=express.colors.sequential.Jet, values=\"share\", names=\"regressor\", color=\"regressor\", ) pie.update_layout( title={ \"x\": 0.5, \"text\": \"Impact Share\", }, width=width, height=height, hovermode=\"x\", template=\"plotly_dark\", showlegend=False, ) pie.update_traces( marker=dict( line=dict(color=\"black\", width=3) ) ) if save: self._save(pie, \"Impact Share\") pie.show() Model Sure, you could spend more time trying different models like moving averages and seasonal arima to evaluate and choose better one eventually, but here it’s a short way to get pretty good base model, which is fast and robust enough.\nCode\rmodel = Prophet(pivot.reset_index(), y=\"Lisbon\", date=\"date\", test_days=7) model.explore(scale=True, title=\"Correlation: Lisbon vs Accra\", save=True) The default implemented strategy saves plotly figures as html code to be viewable aside of the iPython environment. However if one is interested in more uniform way of storage, here is the function to save html as json without building Plotly figure from scratch.\nCode\rimport plotly import json import re def plotly_html_to_json(name: str) -\u003e None: with open(f\"{name}.html\", \"r\", encoding=\"utf-8\") as file: html = file.read() call_arg_str = re.findall(r\"Plotly\\.newPlot\\((.*)\\)\", html[-2**16:])[0] call_args = json.loads(f'[{call_arg_str}]') plotly_json = {'data': call_args[1], 'layout': call_args[2]} figure = plotly.io.from_json(json.dumps(plotly_json)) figure.write_json(f\"{name}.json\") Key findings:\nThere is a steadily growing trend for both cities There is different seasonality for cities: additive weekly seasonality for Lisbon (Thursday, Friday - max, Sunday - min) for Accra it’s no so explicit, and the pattern is different (the maximum is often reached on weekends, and Friday is min) There are different change points for cities: For Lisbon since the beginning of February the increasing trend was replaced by flatten one For Accra the trend is more subtle, but given the difference in absolute number the confidence is such a trend much lower There are outliers: For Lisbon Feb 26 is enormously higher, the reason could be the national holiday - carnival on Feb 25 In addition Feb 14 - not a public holiday but a nice time to have a romantic dinner at home by candlelight For Accra Feb 7 is enormously lower, could be the object for detailed analysis (a bit covered below) Moreover for Accra Feb 26 is the maximum for Ghana as well, may be some promo took place for both cities And the last point of data should be the minimum for Accra, but anyway looks too low, might be the dataset doesn’t include all the orders until the end of the day Outliers Investigation To interpret outliers one of the possible options is to explore Delivery Success rate\nCode\rdb.query(\"\"\" WITH temp AS ( SELECT \"Created Date\" ,\"City\" ,\"Order State\" ,COUNT(\"Order ID\") as \"Orders Count\" FROM orders o WHERE \"City\" in ('Accra', 'Lisbon') AND \"Created Date\" IN ( '06.02.2020', '07.02.2020', '08.02.2020', '26.02.2020', '27.02.2020', '28.02.2020' ) GROUP BY ALL ), totals AS ( SELECT \"Created Date\" ,\"City\" ,SUM(\"Orders Count\") AS \"Orders Total\" FROM temp GROUP BY 1, 2 ) SELECT temp.*, 100 * ROUND(\"Orders Count\"/\"Orders Total\", 4) AS \"Share\" FROM temp JOIN totals USING (\"Created Date\", \"City\") ORDER BY ALL \"\"\").to_df() Created Date City Order State Orders Count Share 0 06.02.2020 Accra delivered 229 91.60 1 06.02.2020 Accra failed 11 4.40 2 06.02.2020 Accra rejected 10 4.00 3 06.02.2020 Lisbon delivered 1855 98.78 4 06.02.2020 Lisbon failed 1 0.05 5 06.02.2020 Lisbon rejected 22 1.17 6 07.02.2020 Accra delivered 161 86.10 7 07.02.2020 Accra failed 23 12.30 8 07.02.2020 Accra rejected 3 1.60 9 07.02.2020 Lisbon delivered 1725 99.19 10 07.02.2020 Lisbon failed 4 0.23 11 07.02.2020 Lisbon rejected 10 0.58 12 08.02.2020 Accra delivered 264 95.65 13 08.02.2020 Accra failed 4 1.45 14 08.02.2020 Accra rejected 8 2.90 15 08.02.2020 Lisbon delivered 1246 99.12 16 08.02.2020 Lisbon failed 6 0.48 17 08.02.2020 Lisbon rejected 5 0.40 18 26.02.2020 Accra delivered 355 96.47 19 26.02.2020 Accra failed 6 1.63 20 26.02.2020 Accra rejected 7 1.90 21 26.02.2020 Lisbon delivered 2307 98.84 22 26.02.2020 Lisbon failed 8 0.34 23 26.02.2020 Lisbon rejected 19 0.81 24 27.02.2020 Accra delivered 300 92.31 25 27.02.2020 Accra failed 13 4.00 26 27.02.2020 Accra rejected 12 3.69 27 27.02.2020 Lisbon delivered 2201 98.79 28 27.02.2020 Lisbon failed 6 0.27 29 27.02.2020 Lisbon rejected 21 0.94 30 28.02.2020 Accra delivered 206 85.83 31 28.02.2020 Accra failed 17 7.08 32 28.02.2020 Accra rejected 17 7.08 33 28.02.2020 Lisbon delivered 2030 98.88 34 28.02.2020 Lisbon failed 7 0.34 35 28.02.2020 Lisbon rejected 16 0.78 If you’re a fan of pandas of course it may be easier to apply similar operations within familiar package, and it even may seem as more Pythonic way to do so, although believe me, once you start using duckdb, it turns out that some operations are just more native to SQL like complex joins and window functions and you naturally perform them faster in SQL; work smarter, not harder - if you’re inventing a bicycle writing SQL alike transformations in Pandas, nobody beyond your internal perfectionist will reward it.\nPandas alternative Code\rtemp = orders[ ( (orders[\"City\"] == \"Accra\") | (orders[\"City\"] == \"Lisbon\") ) \u0026 ( (orders[\"Created Date\"] == '06.02.2020') | (orders[\"Created Date\"] == '07.02.2020') | (orders[\"Created Date\"] == '08.02.2020') | (orders[\"Created Date\"] == '26.02.2020') | (orders[\"Created Date\"] == '27.02.2020') | (orders[\"Created Date\"] == '28.02.2020') ) ].groupby([\"Created Date\", \"City\", \"Order State\"]).agg({\"Order ID\": \"count\"}) temp.join( temp.groupby([\"Created Date\", \"City\"]).sum(), on=[\"Created Date\", \"City\"], rsuffix=\" Total\" ).apply( lambda x: 100 * round(x[\"Order ID\"] / x[\"Order ID Total\"], 4), axis=1 ) Insight: Quick analysis for Feb 7 and for Feb 28 shows that the percentage of delivered orders in Accra is lower than usual while for Lisbon there is no such a drop, that is one of the potential reason of outliers\nMake a forecast of the number of orders expected in the following 4 weeks The correlation between two cities is not that high (Pearson coef is less than 0.5) to leverage it, providing the other country as a predictor\nPortugal (Lisbon) Fit Code\rmodel = Prophet(pivot[\"Lisbon\"].reset_index(), y=\"Lisbon\", date=\"date\", test_days=7) Incorporate all the logic described within the previous point:\nlinear trend weekly additive seasonality Carnival, Valentine Day as outliers Last week as a validation time frame\nCode\rmodel.run( growth='linear', yearly_seasonality=False, monthly_seasonality=False, seasonality_mode='additive', country_holidays='PT', outliers=[(\"2020-02-13\", \"2020-02-15\")] ) model.show( title=\"Lisbon\", y_label=\"Orders, #\", save=True, ) Summary: model fits well, the last week expectedly exceeds the upper bounds due to the holiday\nPredict Code\rlibon = model.model.make_future_dataframe(periods=36).join(pivot[\"Lisbon\"], on=\"ds\") model = Prophet(libon, y=\"Lisbon\", date=\"ds\", test_days=28) model.run( growth='linear', yearly_seasonality=False, monthly_seasonality=False, seasonality_mode='additive', country_holidays='PT', outliers=[(\"2020-02-13\", \"2020-02-15\")] ) model.show( title=\"Lisbon Prognosis\", y_label=\"Orders, #\", save=True, ) Ghana (Accra) The same algorithm for Accra\nFit Code\rmodel = Prophet(pivot[\"Accra\"].reset_index(), y=\"Accra\", date=\"date\", test_days=7) Incorporate all the logic described within the previous point:\nlinear trend weekly additive seasonality Feb 7 \u0026 Feb 28 as outliers Last week as a validation time frame\nCode\rmodel.run( growth='linear', yearly_seasonality=False, monthly_seasonality=False, seasonality_mode='additive', outliers=[(\"2020-02-06\", \"2020-02-08\"), (\"2020-02-27\", \"2020-02-29\")] ) model.show( title=\"Accra\", y_label=\"Orders, #\", save=True, ) Summary: model fits well, but the last week exceeds the lower bounds of CI, as it was explored below one of the reason is the drop in the delivery success rate, anyway let’s take into account this week for the forecast for March.\nPredict Code\raccra = model.model.make_future_dataframe(periods=36).join(pivot[\"Accra\"], on=\"ds\") model = Prophet(accra, y=\"Accra\", date=\"ds\", test_days=28) model.run( growth='linear', yearly_seasonality=False, monthly_seasonality=False, seasonality_mode='additive', outliers=[(\"2020-02-06\", \"2020-02-08\"), (\"2020-02-27\", \"2020-02-29\")] ) model.show( title=\"Accra Prognosis\", y_label=\"Orders, #\", save=True, ) Several Notes:\nLisbon: Valentine Day: Feb 14 was unusual day, my initial idea seems to be right based upon the cuisine which was specific to this date. The burgers which is the main cuisine were not so popular this day, but there were spikes for the meals for the group of people and “romantic” food, namely Japanese (Sushi) \u0026 Italian (Pizza) as well as Breakfast, Ice Cream, Desserts Average Check: During the top weekdays in addition to orders number the average order values grows, not only more people order, but each person order more Accra: Delivered Percentage: first of all the delivered percentage for Accra is less than for Lisbon in general (statistical significance is checked below) and the second point is more accurate look at the dynamic, indeed there were some problems on Feb 7 (driver: ios failed) \u0026 Feb 28 (driver: android rejected) Delivery Time: there is a positive trend in delivery time, one of the reasons can be the launch of the new suppliers, but it’s impossible to check precisely using the given time frame only Conclusion Instead of Summary: If you don’t have enough time, to go too much in detail (it doesn’t mean that one can solve only well formulated problems, sometimes it only means that a person indeed doesn’t have much time) use this high-level approach to explore you data and get immediate insights about your data structure; because after all arbitrarily amount of time can be spent on researching the data, but business never wants to wait.\n",
  "wordCount" : "3671",
  "inLanguage": "en",
  "datePublished": "2023-09-02T00:00:00Z",
  "dateModified": "2023-09-02T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Nikita Podlozhniy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://npodlozhniy.github.io/posts/timeseries-analysis/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Nikita Podlozhniy",
    "logo": {
      "@type": "ImageObject",
      "url": "https://npodlozhniy.github.io/favicons/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://npodlozhniy.github.io/" accesskey="h" title="Nikita Podlozhniy (Alt + H)">Nikita Podlozhniy</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://npodlozhniy.github.io/ru/" title="Russian"
                            aria-label=":ru:">Ru</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://npodlozhniy.github.io/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://npodlozhniy.github.io/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://npodlozhniy.github.io/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://npodlozhniy.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://npodlozhniy.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://npodlozhniy.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Time Series Analysis in Python
    </h1>
    <div class="post-meta"><span title='2023-09-02 00:00:00 +0000 UTC'>September 2, 2023</span>&nbsp;·&nbsp;18 min&nbsp;·&nbsp;Nikita Podlozhniy

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#intro" aria-label="Intro">Intro</a><ul>
                        
                <li>
                    <a href="#are-there-any-discernible-patterns-or-seasonality-present" aria-label="Are there any discernible patterns or seasonality present?">Are there any discernible patterns or seasonality present?</a><ul>
                        
                <li>
                    <a href="#data" aria-label="Data">Data</a></li>
                <li>
                    <a href="#libraries" aria-label="Libraries">Libraries</a></li>
                <li>
                    <a href="#model" aria-label="Model">Model</a></li>
                <li>
                    <a href="#outliers-investigation" aria-label="Outliers Investigation">Outliers Investigation</a><ul>
                        
                <li>
                    <a href="#pandas-alternative" aria-label="Pandas alternative">Pandas alternative</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#make-a-forecast-of-the-number-of-orders-expected-in-the-following-4-weeks" aria-label="Make a forecast of the number of orders expected in the following 4 weeks">Make a forecast of the number of orders expected in the following 4 weeks</a><ul>
                        
                <li>
                    <a href="#portugal-lisbon" aria-label="Portugal (Lisbon)">Portugal (Lisbon)</a><ul>
                        
                <li>
                    <a href="#fit" aria-label="Fit">Fit</a></li>
                <li>
                    <a href="#predict" aria-label="Predict">Predict</a></li></ul>
                </li>
                <li>
                    <a href="#ghana-accra" aria-label="Ghana (Accra)">Ghana (Accra)</a><ul>
                        
                <li>
                    <a href="#fit-1" aria-label="Fit">Fit</a></li>
                <li>
                    <a href="#predict-1" aria-label="Predict">Predict</a></li></ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.25.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>
<h1 id="intro">Intro<a hidden class="anchor" aria-hidden="true" href="#intro">#</a></h1>
<p>It&rsquo;s a short yet handy guide on how to analyze time series data in a few clicks using modern Python libraries.</p>
<p>Tech stack for this guide consists of</p>
<ul>
<li><code>duckdb</code> and <code>pandas</code> packages for data processing</li>
<li>Facebook&rsquo;s <code>prophet</code> for data exploration and forecasting</li>
<li><code>plotly</code> for data visualization</li>
</ul>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> duckdb <span style="color:#66d9ef">as</span> db
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>orders <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;orders_data.csv&#39;</span>)
</span></span><span style="display:flex;"><span>orders<span style="color:#f92672">.</span>sample()
</span></span></code></pre></div></details>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>Created Date</th>
<th>Country</th>
<th>City</th>
<th>Restaurant ID</th>
<th>Restaurant Name</th>
<th>Order State</th>
<th>Cancel Reason</th>
<th>Cuisine</th>
<th>Platform</th>
<th>Products in Order</th>
<th>Order Value € (Gross)</th>
<th>Delivery Fee</th>
<th>Delivery Time</th>
<th>Order ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>44255</td>
<td>10.01.2020</td>
<td>Portugal</td>
<td>Lisbon</td>
<td>6167</td>
<td>H3 Armazéns do Chiado</td>
<td>delivered</td>
<td>NaN</td>
<td>Mediterranean</td>
<td>ios</td>
<td>1</td>
<td>€9.55</td>
<td>0.0</td>
<td>14.7</td>
<td>379143844</td>
</tr>
</tbody>
</table>
</div>
<h2 id="are-there-any-discernible-patterns-or-seasonality-present">Are there any discernible patterns or seasonality present?<a hidden class="anchor" aria-hidden="true" href="#are-there-any-discernible-patterns-or-seasonality-present">#</a></h2>
<p>Usually it&rsquo;s good to start any time series analysis with tackling four key questions:</p>
<ul>
<li>Is there any trend?</li>
<li>Is there seasonality, if so which type: additive or multiplicative?</li>
<li>Is there any explicit change points, which we should consider?</li>
<li>Are there outliers? - Get rid of them!</li>
</ul>
<h3 id="data">Data<a hidden class="anchor" aria-hidden="true" href="#data">#</a></h3>
<p>If you never experienced <code>duckdb</code> before, I totally recommend you to try as it boosts your efficiency allowing simultaneous usage of best features from Python and SQL</p>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    SELECT strptime(&#34;Created Date&#34;, &#39;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">.%m.%Y&#39;) as date
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ,&#34;City&#34; as city
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ,count(*) as orders
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    FROM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            orders o
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    WHERE &#34;Order State&#34; = &#39;delivered&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    GROUP BY 1, 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>)<span style="color:#f92672">.</span>to_df()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pivot <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>pivot(index<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;date&#39;</span>, columns<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;city&#39;</span>, values<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orders&#39;</span>)
</span></span><span style="display:flex;"><span>pivot<span style="color:#f92672">.</span>head()
</span></span></code></pre></div></details>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th>city</th>
<th>Accra</th>
<th>Lisbon</th>
</tr>
</thead>
<tbody>
<tr>
<td>date</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2020-01-01</td>
<td>124</td>
<td>882</td>
</tr>
<tr>
<td>2020-01-02</td>
<td>126</td>
<td>1104</td>
</tr>
<tr>
<td>2020-01-03</td>
<td>76</td>
<td>1110</td>
</tr>
<tr>
<td>2020-01-04</td>
<td>169</td>
<td>784</td>
</tr>
<tr>
<td>2020-01-05</td>
<td>198</td>
<td>788</td>
</tr>
</tbody>
</table>
</div>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;We have data for </span><span style="color:#e6db74">{</span>pivot<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> consecutive days&#34;</span>)
</span></span></code></pre></div></details>
<pre><code>We have data for 59 consecutive days
</code></pre>
<h3 id="libraries">Libraries<a hidden class="anchor" aria-hidden="true" href="#libraries">#</a></h3>
<p>I&rsquo;m using my own time series model wrappers to explore and forecast the data, they are based upon popular libraries from big tech companies, in this particular case, on <a href="https://facebook.github.io/prophet/">Facebook Prophet</a></p>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Optional, List, Tuple
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> plotly <span style="color:#f92672">import</span> express, graph_objects
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> plotly.subplots <span style="color:#f92672">import</span> make_subplots
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> prophet <span style="color:#f92672">import</span> Prophet <span style="color:#66d9ef">as</span> FP
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> prophet.utilities <span style="color:#f92672">import</span> regressor_coefficients
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> MinMaxScaler
</span></span></code></pre></div></details>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ModelWrapper</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Custom Wrapper for popular models for TimeSeries analysis, including but not limited to:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - Google Causal Impact https://pypi.org/project/causalimpact/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - Facebook Prophet https://facebook.github.io/prophet/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    df: DataFrame containg target variable with `y` name and time frame variable with `date` name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    start_date: the start date of experiment with the format YYYY-MM-DD
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    test_days: the number of last days in which the experiment was run
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    end_date: the end date of experiment with the format YYYY-MM-DD
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    date: timeframe column name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    y: target column name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Attributes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    explore: the chart exploring pre-experiment correlations
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    show: visualization of the trained model, please notet that you need to run the model first
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        df: pd<span style="color:#f92672">.</span>DataFrame,
</span></span><span style="display:flex;"><span>        start_date: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        test_days: Optional[int] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        end_date: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        date: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;date&#34;</span>,
</span></span><span style="display:flex;"><span>        y: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;y&#34;</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>df <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>date <span style="color:#f92672">=</span> date
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> start_date:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>start_dt <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>strptime(start_date, <span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>date()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> test_days:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> pd<span style="color:#f92672">.</span>core<span style="color:#f92672">.</span>dtypes<span style="color:#f92672">.</span>common<span style="color:#f92672">.</span>is_datetime64_dtype(self<span style="color:#f92672">.</span>df[self<span style="color:#f92672">.</span>date]<span style="color:#f92672">.</span>dtype):
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>start_dt <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>df[self<span style="color:#f92672">.</span>date]<span style="color:#f92672">.</span>max()<span style="color:#f92672">.</span>date() <span style="color:#f92672">-</span> datetime<span style="color:#f92672">.</span>timedelta(days<span style="color:#f92672">=</span>test_days)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>start_dt <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>strptime(self<span style="color:#f92672">.</span>df[self<span style="color:#f92672">.</span>date]<span style="color:#f92672">.</span>max(), <span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>date() <span style="color:#f92672">-</span> datetime<span style="color:#f92672">.</span>timedelta(days<span style="color:#f92672">=</span>test_days)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;You must specify start_date or test_days variable&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>end_dt <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>strptime(end_date, <span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>date() <span style="color:#66d9ef">if</span> end_date <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> list(self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>columns<span style="color:#f92672">.</span>difference([self<span style="color:#f92672">.</span>date, self<span style="color:#f92672">.</span>y])<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_preprocess()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_preprocess</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>df[self<span style="color:#f92672">.</span>date] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(self<span style="color:#f92672">.</span>df[self<span style="color:#f92672">.</span>date])<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>date
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>df <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>df[[self<span style="color:#f92672">.</span>y, self<span style="color:#f92672">.</span>date] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>x]<span style="color:#f92672">.</span>set_index(self<span style="color:#f92672">.</span>date)<span style="color:#f92672">.</span>sort_index()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> column <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>columns[self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>dtypes <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;object&#34;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>df[column] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>df[column]<span style="color:#f92672">.</span>astype(float)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;All DataFrame columns except Date must be numeric&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_save</span>(figure, title: str) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>write_html(
</span></span><span style="display:flex;"><span>            re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;[-:&lt;&gt;|\/\*\?</span><span style="color:#ae81ff">\&#34;\\\\</span><span style="color:#e6db74"> ]+&#39;</span>, <span style="color:#e6db74">&#39;_&#39;</span>,  title<span style="color:#f92672">.</span>lower()) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.html&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">explore</span>(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        scale: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        title: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pre-experiment correlation&#34;</span>,
</span></span><span style="display:flex;"><span>        x_label: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        y_label: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        width: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">900</span>,
</span></span><span style="display:flex;"><span>        height: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>,
</span></span><span style="display:flex;"><span>        save: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Plot the dynamic of pre-experiment correlation
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        scale: whether the samples should be scaled to [0, 1] interval
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        title: the title of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        x_label: label for X axis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        y_label: label for Y axis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        width: the width of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        height: the height of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        save: whether you want to save the chart as HTML
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> scale:
</span></span><span style="display:flex;"><span>            scaler <span style="color:#f92672">=</span> MinMaxScaler(feature_range<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>            data[data<span style="color:#f92672">.</span>columns] <span style="color:#f92672">=</span> scaler<span style="color:#f92672">.</span>fit_transform(data)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        corr <span style="color:#f92672">=</span> data[data<span style="color:#f92672">.</span>index <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>start_dt]<span style="color:#f92672">.</span>corr()<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>melt(
</span></span><span style="display:flex;"><span>            data,
</span></span><span style="display:flex;"><span>            value_vars<span style="color:#f92672">=</span>list(data<span style="color:#f92672">.</span>columns),
</span></span><span style="display:flex;"><span>            var_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;variable&#34;</span>,
</span></span><span style="display:flex;"><span>            value_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;value&#34;</span>,
</span></span><span style="display:flex;"><span>            ignore_index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        chart_title <span style="color:#f92672">=</span> title <span style="color:#f92672">+</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;&lt;br&gt;&lt;sup&gt;</span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(
</span></span><span style="display:flex;"><span>            [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>feature<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>round(value, <span style="color:#ae81ff">2</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> feature, value <span style="color:#f92672">in</span> zip(self<span style="color:#f92672">.</span>x, corr)]
</span></span><span style="display:flex;"><span>        )<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/sup&gt;&lt;/br&gt;&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        figure <span style="color:#f92672">=</span> express<span style="color:#f92672">.</span>line(
</span></span><span style="display:flex;"><span>            data,
</span></span><span style="display:flex;"><span>            x<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>index,
</span></span><span style="display:flex;"><span>            y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;value&#34;</span>,
</span></span><span style="display:flex;"><span>            color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;variable&#34;</span>,
</span></span><span style="display:flex;"><span>            height<span style="color:#f92672">=</span>height,
</span></span><span style="display:flex;"><span>            width<span style="color:#f92672">=</span>width,
</span></span><span style="display:flex;"><span>            title<span style="color:#f92672">=</span>chart_title,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>add_vline(x<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>start_dt, line_width<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, line_dash<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dash&#34;</span>, line_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;white&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>end_dt:
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>add_vline(x<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>end_dt, line_width<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, line_dash<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dash&#34;</span>, line_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;white&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>update_traces(hovertemplate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%</span><span style="color:#e6db74">{y}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>update_xaxes(title_text<span style="color:#f92672">=</span>x_label <span style="color:#66d9ef">if</span> x_label <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;Date&#34;</span>)
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>update_yaxes(title_text<span style="color:#f92672">=</span>y_label <span style="color:#66d9ef">if</span> y_label <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;Scaled Axis&#34;</span> <span style="color:#66d9ef">if</span> scale <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;Original Axis&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>update_layout(
</span></span><span style="display:flex;"><span>            title<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            legend<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">0.05</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;y&#34;</span>: <span style="color:#ae81ff">1.05</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;orientation&#34;</span>: <span style="color:#e6db74">&#34;h&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;title&#34;</span>: <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            hovermode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x&#34;</span>,
</span></span><span style="display:flex;"><span>            template<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;plotly_dark&#34;</span>,
</span></span><span style="display:flex;"><span>            xaxis<span style="color:#f92672">=</span>dict(hoverformat<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%a</span><span style="color:#e6db74">, %b </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">, %Y&#34;</span>),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> save:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>_save(figure, title)     
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_add_chart</span>(
</span></span><span style="display:flex;"><span>        figure,
</span></span><span style="display:flex;"><span>        data: pd<span style="color:#f92672">.</span>DataFrame,
</span></span><span style="display:flex;"><span>        titles: list,
</span></span><span style="display:flex;"><span>        y: str,
</span></span><span style="display:flex;"><span>        name: str,
</span></span><span style="display:flex;"><span>        row: int,
</span></span><span style="display:flex;"><span>        actual: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        y_label: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>add_trace(
</span></span><span style="display:flex;"><span>            graph_objects<span style="color:#f92672">.</span>Scatter(
</span></span><span style="display:flex;"><span>                x<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>index,
</span></span><span style="display:flex;"><span>                y<span style="color:#f92672">=</span>data[y],
</span></span><span style="display:flex;"><span>                name<span style="color:#f92672">=</span>name,
</span></span><span style="display:flex;"><span>                hovertemplate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%</span><span style="color:#e6db74">{y}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                line<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;color&#34;</span>: <span style="color:#e6db74">&#34;white&#34;</span>},
</span></span><span style="display:flex;"><span>                legendgroup<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>row<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                legendgrouptitle<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;text&#34;</span>: titles[row]},
</span></span><span style="display:flex;"><span>                connectgaps<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            row<span style="color:#f92672">=</span>row,
</span></span><span style="display:flex;"><span>            col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>add_trace(
</span></span><span style="display:flex;"><span>            graph_objects<span style="color:#f92672">.</span>Scatter(
</span></span><span style="display:flex;"><span>                x<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>index,
</span></span><span style="display:flex;"><span>                y<span style="color:#f92672">=</span>data[y <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_upper&#34;</span>],
</span></span><span style="display:flex;"><span>                name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Upper bound&#34;</span>,
</span></span><span style="display:flex;"><span>                hovertemplate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%</span><span style="color:#e6db74">{y}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                line<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;color&#34;</span>: <span style="color:#e6db74">&#34;deepskyblue&#34;</span>, <span style="color:#e6db74">&#34;width&#34;</span>: <span style="color:#ae81ff">0.5</span>},
</span></span><span style="display:flex;"><span>                legendgroup<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>row<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                connectgaps<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            row<span style="color:#f92672">=</span>row,
</span></span><span style="display:flex;"><span>            col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>add_trace(
</span></span><span style="display:flex;"><span>            graph_objects<span style="color:#f92672">.</span>Scatter(
</span></span><span style="display:flex;"><span>                x<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>index,
</span></span><span style="display:flex;"><span>                y<span style="color:#f92672">=</span>data[y <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_lower&#34;</span>],
</span></span><span style="display:flex;"><span>                name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Lower bound&#34;</span>,
</span></span><span style="display:flex;"><span>                hovertemplate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%</span><span style="color:#e6db74">{y}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                fill<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tonexty&#34;</span>,
</span></span><span style="display:flex;"><span>                line<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;color&#34;</span>: <span style="color:#e6db74">&#34;deepskyblue&#34;</span>, <span style="color:#e6db74">&#34;width&#34;</span>: <span style="color:#ae81ff">0.5</span>},
</span></span><span style="display:flex;"><span>                legendgroup<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>row<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                connectgaps<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>            row<span style="color:#f92672">=</span>row,
</span></span><span style="display:flex;"><span>            col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>update_yaxes(title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> y_label <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">% E</span><span style="color:#e6db74">ffect&#34;</span> <span style="color:#66d9ef">if</span> row <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span> <span style="color:#66d9ef">else</span> y_label)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> actual:
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>add_trace(
</span></span><span style="display:flex;"><span>                graph_objects<span style="color:#f92672">.</span>Scatter(
</span></span><span style="display:flex;"><span>                    x<span style="color:#f92672">=</span>data<span style="color:#f92672">.</span>index,
</span></span><span style="display:flex;"><span>                    y<span style="color:#f92672">=</span>data[<span style="color:#e6db74">&#34;response&#34;</span>],
</span></span><span style="display:flex;"><span>                    name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Actual&#34;</span>,
</span></span><span style="display:flex;"><span>                    hovertemplate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%</span><span style="color:#e6db74">{y}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                    line<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;color&#34;</span>: <span style="color:#e6db74">&#34;red&#34;</span>},
</span></span><span style="display:flex;"><span>                    legendgroup<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>row<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                    connectgaps<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>                row<span style="color:#f92672">=</span>row,
</span></span><span style="display:flex;"><span>                col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>add_hline(y<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, line_width<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, line_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;white&#34;</span>, row<span style="color:#f92672">=</span>row, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">show</span>(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        keep_n_prior_days: Optional[int] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        title: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Causal Impact&#34;</span>,
</span></span><span style="display:flex;"><span>        x_label: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        y_label: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        width: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">900</span>,
</span></span><span style="display:flex;"><span>        height: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>,
</span></span><span style="display:flex;"><span>        save: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Plot the trained model results
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        keep_n_prior_days: specify the exact number of pre-experiment days you want to keep, skip if you want to show all the time frame
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        title: the title of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        x_label: label for X axis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        y_label: label for Y axis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        width: the width of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        height: the height of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        save: whether you want to save the chart as HTML
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> keep_n_prior_days:
</span></span><span style="display:flex;"><span>                data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>result[
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>result<span style="color:#f92672">.</span>index <span style="color:#f92672">&gt;</span> self<span style="color:#f92672">.</span>start_dt <span style="color:#f92672">-</span> datetime<span style="color:#f92672">.</span>timedelta(days<span style="color:#f92672">=</span>keep_n_prior_days)
</span></span><span style="display:flex;"><span>                ]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>result<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">AttributeError</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">AttributeError</span>(<span style="color:#e6db74">&#34;To show the results run the model first, use .run() method&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        titles <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Model Overview&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Actual vs Expected&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Effect Size: Actual - Expected&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Cumulative Effect&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Effect Relative to Expected&#34;</span>,
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(self, CausalImpact):
</span></span><span style="display:flex;"><span>            figure <span style="color:#f92672">=</span> make_subplots(
</span></span><span style="display:flex;"><span>                rows<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, cols<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, shared_xaxes<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, subplot_titles<span style="color:#f92672">=</span>titles[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> y, name, row <span style="color:#f92672">in</span> zip(
</span></span><span style="display:flex;"><span>                [<span style="color:#e6db74">&#34;point_pred&#34;</span>, <span style="color:#e6db74">&#34;point_effect&#34;</span>, <span style="color:#e6db74">&#34;cum_effect&#34;</span>, <span style="color:#e6db74">&#34;rel_effect&#34;</span>],
</span></span><span style="display:flex;"><span>                [<span style="color:#e6db74">&#34;Expected Values&#34;</span>, <span style="color:#e6db74">&#34;Effect Size&#34;</span>, <span style="color:#e6db74">&#34;Cumulative Effect&#34;</span>, <span style="color:#e6db74">&#34;Relative Effect&#34;</span>],
</span></span><span style="display:flex;"><span>                range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>            ):
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_add_chart(
</span></span><span style="display:flex;"><span>                    figure,
</span></span><span style="display:flex;"><span>                    data,
</span></span><span style="display:flex;"><span>                    titles,
</span></span><span style="display:flex;"><span>                    y<span style="color:#f92672">=</span>y,
</span></span><span style="display:flex;"><span>                    name<span style="color:#f92672">=</span>name,
</span></span><span style="display:flex;"><span>                    row<span style="color:#f92672">=</span>row,
</span></span><span style="display:flex;"><span>                    actual<span style="color:#f92672">=</span>(row <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>                    y_label<span style="color:#f92672">=</span>y_label
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> isinstance(self, Prophet):
</span></span><span style="display:flex;"><span>            row <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            figure <span style="color:#f92672">=</span> make_subplots()
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>_add_chart(
</span></span><span style="display:flex;"><span>                figure,
</span></span><span style="display:flex;"><span>                data,
</span></span><span style="display:flex;"><span>                titles,
</span></span><span style="display:flex;"><span>                y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;yhat&#34;</span>,
</span></span><span style="display:flex;"><span>                name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Expected Value&#34;</span>,
</span></span><span style="display:flex;"><span>                row<span style="color:#f92672">=</span>row,
</span></span><span style="display:flex;"><span>                actual<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>                y_label<span style="color:#f92672">=</span>y_label
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>update_xaxes(title_text<span style="color:#f92672">=</span>x_label <span style="color:#66d9ef">if</span> x_label <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;Date&#34;</span>, row<span style="color:#f92672">=</span>row, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>add_vline(x<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>start_dt, line_width<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, line_dash<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dash&#34;</span>, line_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;white&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>end_dt:
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>add_vline(x<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>end_dt, line_width<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, line_dash<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dash&#34;</span>, line_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;white&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>update_layout(
</span></span><span style="display:flex;"><span>            title<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;text&#34;</span>: title,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            width<span style="color:#f92672">=</span>width,
</span></span><span style="display:flex;"><span>            height<span style="color:#f92672">=</span>height,
</span></span><span style="display:flex;"><span>            hovermode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x&#34;</span>,
</span></span><span style="display:flex;"><span>            template<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;plotly_dark&#34;</span>,
</span></span><span style="display:flex;"><span>            legend<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;y&#34;</span>: <span style="color:#f92672">-</span><span style="color:#ae81ff">0.2</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;orientation&#34;</span>: <span style="color:#e6db74">&#34;h&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;groupclick&#34;</span>: <span style="color:#e6db74">&#34;toggleitem&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;traceorder&#34;</span>: <span style="color:#e6db74">&#34;grouped&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            xaxis<span style="color:#f92672">=</span>dict(hoverformat<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%a</span><span style="color:#e6db74">, %b </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">, %Y&#34;</span>),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> save:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>_save(figure, title)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        figure<span style="color:#f92672">.</span>show()
</span></span></code></pre></div></details>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CausalImpact</span>(ModelWrapper):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        nseasons: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>,
</span></span><span style="display:flex;"><span>        season_duration: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        alpha: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">**</span>kwargs
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">-&gt;</span> pd<span style="color:#f92672">.</span>DataFrame:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Run causal impact analysis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        nseasons: Period of the seasonal components.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            In order to include a seasonal component, set this to a whole number greater than 1.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            For example, if the data represent daily observations, use 7 for a day-of-week component.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            This interface currently only supports up to one seasonal component.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        season_duration: Duration of each season, i.e., number of data points each season spans.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            For example, to add a day-of-week component to data with daily granularity, use model_args = list(nseasons = 7, season_duration = 1).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            To add a day-of-week component to data with hourly granularity, set model_args = list(nseasons = 7, season_duration = 24).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        alpha : Desired tail-area probability for posterior intervals. Defaults to 0.05, which will produce central 95</span><span style="color:#e6db74">% i</span><span style="color:#e6db74">ntervals
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Other Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        **kwargs : model_args variables, available options:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ndraws: number of MCMC samples to draw.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                More samples lead to more accurate inferences. Defaults to 1000.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            nburn: number of burn in samples.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                This specifies how many of the initial samples will be discarded. defaults to 10</span><span style="color:#e6db74">% o</span><span style="color:#e6db74">f ndraws.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            standardize_data: whether to standardize all columns of the data before fitting the model.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                This is equivalent to an empirical Bayes approach to setting the priors.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                It ensures that results are invariant to linear transformations of the data.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            prior_level_sd: prior standard deviation of the Gaussian random walk of the local level.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Expressed in terms of data standard deviations. Defaults to 0.01.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                A typical choice for well-behaved and stable datasets with low residual volatility after regressing out known predictors.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                When in doubt, a safer option is to use 0.1, as validated on synthetic data,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                although this may sometimes give rise to unrealistically wide prediction intervals.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            dynamic_regression: whether to include time-varying regression coefficients.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                In combination with a time-varying local trend or even a time-varying local level,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                this often leads to overspecification, in which case a static regression is safer. Defaults to FALSE.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>copy()<span style="color:#f92672">.</span>reset_index()
</span></span><span style="display:flex;"><span>        prior <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            data<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>min(),
</span></span><span style="display:flex;"><span>            int(data[data[self<span style="color:#f92672">.</span>date] <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>start_dt]<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>max())
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        posterior <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            int(data[data[self<span style="color:#f92672">.</span>date] <span style="color:#f92672">&gt;=</span> (self<span style="color:#f92672">.</span>end_dt <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>end_dt <span style="color:#66d9ef">else</span> self<span style="color:#f92672">.</span>start_dt)]<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>min()),
</span></span><span style="display:flex;"><span>            data<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>max()
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        data<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[self<span style="color:#f92672">.</span>date], inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ci <span style="color:#f92672">=</span> CI(
</span></span><span style="display:flex;"><span>            data,
</span></span><span style="display:flex;"><span>            prior,
</span></span><span style="display:flex;"><span>            posterior,
</span></span><span style="display:flex;"><span>            model_args<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;nseasons&#34;</span>: nseasons,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;season_duration&#34;</span>: season_duration,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">**</span>kwargs
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            alpha<span style="color:#f92672">=</span>alpha,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ci<span style="color:#f92672">.</span>run()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">summary</span>(self, format: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;summary&#34;</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Print the summary for Causal Impact Analysis model
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        format: can be &#39;summary&#39; to return a table or &#39;report&#39; to return a natural language description
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>ci<span style="color:#f92672">.</span>summary(format)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">AttributeError</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">AttributeError</span>(<span style="color:#e6db74">&#34;To get the summary run the model first, use .run() method&#34;</span>)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ci<span style="color:#f92672">.</span>inferences<span style="color:#f92672">.</span>set_index(self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>index)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> suffix <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;_lower&#34;</span>, <span style="color:#e6db74">&#34;_upper&#34;</span>]:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>result[<span style="color:#e6db74">&#34;rel_effect&#34;</span> <span style="color:#f92672">+</span> suffix] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>result[<span style="color:#e6db74">&#34;point_effect&#34;</span> <span style="color:#f92672">+</span> suffix] <span style="color:#f92672">/</span> self<span style="color:#f92672">.</span>result[<span style="color:#e6db74">&#34;point_pred&#34;</span>]
</span></span></code></pre></div></details>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Prophet</span>(ModelWrapper):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        growth: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;linear&#34;</span>,
</span></span><span style="display:flex;"><span>        weekly_seasonality: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        monthly_seasonality: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        yearly_seasonality: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        seasonality_mode: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;additive&#34;</span>,
</span></span><span style="display:flex;"><span>        country_holidays: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        outliers: Optional[List[Tuple[str]]] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        floor: Optional[int] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        cap: Optional[int] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        alpha: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">**</span>kwargs,
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">-&gt;</span> pd<span style="color:#f92672">.</span>DataFrame:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Run time-series forecasting
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        growth: String &#39;linear&#39;, &#39;logistic&#39; or &#39;flat&#39; to specify a linear, logistic or flat trend.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        weekly_seasonality: Fit weekly seasonality.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        monthly_seasonality: Fit monthly seasonality.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        yearly_seasonality: Fit yearly seasonality.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        seasonality_mode: &#39;additive&#39; (default) or &#39;multiplicative&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        country_holidays: country code (e.g. &#39;RU&#39;) of the country whose holiday are to be considered
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        outliers: list of time intervals (start date, end date) with the format YYYY-MM-DD where there are outliers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        floor: minimum allowed value for the target variable. It&#39;s particulary useful with &#34;logistic&#34; growth type
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        cap: maximum allowed value for the target variable. It&#39;s particulary useful with &#34;logistic&#34; growth type
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        alpha: 1 - width of the uncertainty intervals provided for the forecast.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Other Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        **kwargs : model_args variables, to reveal the whole list follow the Prophet documentation, for example:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            n_changepoints: Number of potential changepoints to include. Not used
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                if input `changepoints` is supplied. If `changepoints` is not supplied,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                then n_changepoints potential changepoints are selected uniformly from
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                the first `changepoint_range` proportion of the history.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            changepoint_range: Proportion of history in which trend changepoints will
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                be estimated. Defaults to 0.8 for the first 80%. Not used if
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                `changepoints` is specified.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            changepoint_prior_scale: Parameter modulating the flexibility of the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                automatic changepoint selection. Large values will allow many
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                changepoints, small values will allow few changepoints.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>copy()<span style="color:#f92672">.</span>reset_index()<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{self<span style="color:#f92672">.</span>date: <span style="color:#e6db74">&#34;ds&#34;</span>, self<span style="color:#f92672">.</span>y: <span style="color:#e6db74">&#34;y&#34;</span>})<span style="color:#f92672">.</span>sort_values(<span style="color:#e6db74">&#34;ds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cap:
</span></span><span style="display:flex;"><span>            data[<span style="color:#e6db74">&#34;cap&#34;</span>] <span style="color:#f92672">=</span> cap
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> floor:
</span></span><span style="display:flex;"><span>            data[<span style="color:#e6db74">&#34;floor&#34;</span>] <span style="color:#f92672">=</span> floor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        train, test <span style="color:#f92672">=</span> data[data[<span style="color:#e6db74">&#34;ds&#34;</span>] <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>start_dt], data[data[<span style="color:#e6db74">&#34;ds&#34;</span>] <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>start_dt]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> FP(
</span></span><span style="display:flex;"><span>            growth<span style="color:#f92672">=</span>growth,
</span></span><span style="display:flex;"><span>            weekly_seasonality<span style="color:#f92672">=</span>weekly_seasonality,
</span></span><span style="display:flex;"><span>            yearly_seasonality<span style="color:#f92672">=</span>yearly_seasonality,
</span></span><span style="display:flex;"><span>            seasonality_mode<span style="color:#f92672">=</span>seasonality_mode,
</span></span><span style="display:flex;"><span>            interval_width<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>alpha,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">**</span>kwargs,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> monthly_seasonality:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_seasonality(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;monthly&#34;</span>, period<span style="color:#f92672">=</span><span style="color:#ae81ff">30.5</span>, fourier_order<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> country_holidays:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_country_holidays(country_name<span style="color:#f92672">=</span>country_holidays)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> outliers:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> pair <span style="color:#f92672">in</span> outliers:
</span></span><span style="display:flex;"><span>                train<span style="color:#f92672">.</span>loc[
</span></span><span style="display:flex;"><span>                    (train[<span style="color:#e6db74">&#34;ds&#34;</span>] <span style="color:#f92672">&gt;</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>strptime(pair[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>date()) <span style="color:#f92672">&amp;</span> 
</span></span><span style="display:flex;"><span>                    (train[<span style="color:#e6db74">&#34;ds&#34;</span>] <span style="color:#f92672">&lt;</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>strptime(pair[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>date()),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;y&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> feature <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>x:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>add_regressor(feature)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>fit(train)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        future <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span>test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>predict(future<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#34;ds&#34;</span>)<span style="color:#f92672">.</span>join(data<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#34;ds&#34;</span>))<span style="color:#f92672">.</span>reset_index())
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>result[<span style="color:#e6db74">&#34;ds&#34;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>result[<span style="color:#e6db74">&#34;ds&#34;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>date
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>result<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#34;ds&#34;</span>)<span style="color:#f92672">.</span>join(data[[<span style="color:#e6db74">&#34;ds&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>]]<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#34;ds&#34;</span>))<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;y&#34;</span>: <span style="color:#e6db74">&#34;response&#34;</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">summary</span>(
</span></span><span style="display:flex;"><span>        self,
</span></span><span style="display:flex;"><span>        width: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">900</span>,
</span></span><span style="display:flex;"><span>        height: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>,
</span></span><span style="display:flex;"><span>        save: bool <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">-&gt;</span> pd<span style="color:#f92672">.</span>DataFrame:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Plot the regressors statistics: Coefficients, Impact and Impact Share
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        The estimated beta coefficient for each regressor roughly represents the increase
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        in prediction value for a unit increase in the regressor value.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Note that the coefficients returned are always on the scale of the original data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        In addition the credible interval for each coefficient is also returned,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        which can help identify whether each regressor is “statistically significant”.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        On the basis of `seasonality_mode` the model looks like:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            Additive: y(t) ~ trend(t) + seasonality(t) + beta * regressor(t)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            Multiplicative: y(t) ~ trend(t) * ( 1 + seasonality(t) + beta * regressor(t) )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Therefore, the incremental impact are:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            Additive: increasing the value of the regressor by a unit leads to an increase in y(t) by beta units
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            Multiplicative: increasing the value of the regressor by a unit leads to increase in y(t) by beta * trend(t) units
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        The Impact is the product of incremental impact(t) * regressor(t) and finally, Share is the percentage of absolute Impact
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Parameters
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ----------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        width: the width of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        height: the height of the chart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        save: whether you want to save the chart as HTML
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> regressor_coefficients(self<span style="color:#f92672">.</span>model)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">AttributeError</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">AttributeError</span>(<span style="color:#e6db74">&#34;To get the summary run the model first, use .run() method&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        last_day_data, last_day_result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>df<span style="color:#f92672">.</span>iloc[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :], self<span style="color:#f92672">.</span>result<span style="color:#f92672">.</span>iloc[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        data[<span style="color:#e6db74">&#34;incremental_impact&#34;</span>] <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;coef&#34;</span>] <span style="color:#f92672">*</span> data[<span style="color:#e6db74">&#34;regressor_mode&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: last_day_result[<span style="color:#e6db74">&#34;trend&#34;</span>] <span style="color:#66d9ef">if</span> x <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;multiplicative&#34;</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        data[<span style="color:#e6db74">&#34;impact&#34;</span>] <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: x[<span style="color:#e6db74">&#34;incremental_impact&#34;</span>] <span style="color:#f92672">*</span> last_day_data[x[<span style="color:#e6db74">&#34;regressor&#34;</span>]], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        data[<span style="color:#e6db74">&#34;share&#34;</span>] <span style="color:#f92672">=</span> round(<span style="color:#ae81ff">100</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>abs(data[<span style="color:#e6db74">&#34;impact&#34;</span>]) <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>sum(np<span style="color:#f92672">.</span>abs(data[<span style="color:#e6db74">&#34;impact&#34;</span>])), <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_bar</span>(data, y, title):
</span></span><span style="display:flex;"><span>            figure <span style="color:#f92672">=</span> express<span style="color:#f92672">.</span>bar(
</span></span><span style="display:flex;"><span>                data,
</span></span><span style="display:flex;"><span>                x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;regressor&#34;</span>,
</span></span><span style="display:flex;"><span>                y<span style="color:#f92672">=</span>y,
</span></span><span style="display:flex;"><span>                color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;regressor&#34;</span>,
</span></span><span style="display:flex;"><span>                color_discrete_sequence<span style="color:#f92672">=</span>express<span style="color:#f92672">.</span>colors<span style="color:#f92672">.</span>sequential<span style="color:#f92672">.</span>Jet,
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>add_hline(y<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, line_width<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, line_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;white&#34;</span>)
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>update_xaxes(title_text<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>update_layout(
</span></span><span style="display:flex;"><span>                title<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;text&#34;</span>: title,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                width<span style="color:#f92672">=</span>width,
</span></span><span style="display:flex;"><span>                height<span style="color:#f92672">=</span>height,
</span></span><span style="display:flex;"><span>                hovermode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x&#34;</span>,
</span></span><span style="display:flex;"><span>                template<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;plotly_dark&#34;</span>,
</span></span><span style="display:flex;"><span>                showlegend<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> save:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>_save(figure, title)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            figure<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> y, title <span style="color:#f92672">in</span> zip([<span style="color:#e6db74">&#34;coef&#34;</span>, <span style="color:#e6db74">&#34;impact&#34;</span>], [<span style="color:#e6db74">&#34;Coefficients&#34;</span>, <span style="color:#e6db74">&#34;Impact&#34;</span>]):
</span></span><span style="display:flex;"><span>            plot_bar(data<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coef&#34;</span>, ascending<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>), y, title)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pie <span style="color:#f92672">=</span> express<span style="color:#f92672">.</span>pie(
</span></span><span style="display:flex;"><span>            data<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coef&#34;</span>, ascending<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>),
</span></span><span style="display:flex;"><span>            color_discrete_sequence<span style="color:#f92672">=</span>express<span style="color:#f92672">.</span>colors<span style="color:#f92672">.</span>sequential<span style="color:#f92672">.</span>Jet,
</span></span><span style="display:flex;"><span>            values<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;share&#34;</span>,
</span></span><span style="display:flex;"><span>            names<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;regressor&#34;</span>,
</span></span><span style="display:flex;"><span>            color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;regressor&#34;</span>,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pie<span style="color:#f92672">.</span>update_layout(
</span></span><span style="display:flex;"><span>            title<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Impact Share&#34;</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            width<span style="color:#f92672">=</span>width,
</span></span><span style="display:flex;"><span>            height<span style="color:#f92672">=</span>height,
</span></span><span style="display:flex;"><span>            hovermode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x&#34;</span>,
</span></span><span style="display:flex;"><span>            template<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;plotly_dark&#34;</span>,
</span></span><span style="display:flex;"><span>            showlegend<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pie<span style="color:#f92672">.</span>update_traces(
</span></span><span style="display:flex;"><span>            marker<span style="color:#f92672">=</span>dict(
</span></span><span style="display:flex;"><span>                line<span style="color:#f92672">=</span>dict(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;black&#34;</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> save:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>_save(pie, <span style="color:#e6db74">&#34;Impact Share&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pie<span style="color:#f92672">.</span>show()
</span></span></code></pre></div></details>
<h3 id="model">Model<a hidden class="anchor" aria-hidden="true" href="#model">#</a></h3>
<p>Sure, you could spend more time trying different models like moving averages and seasonal arima to evaluate and choose better one eventually, but here it&rsquo;s a short way to get pretty good base model, which is fast and robust enough.</p>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>model <span style="color:#f92672">=</span> Prophet(pivot<span style="color:#f92672">.</span>reset_index(), y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Lisbon&#34;</span>, date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;date&#34;</span>, test_days<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>explore(scale<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Correlation: Lisbon vs Accra&#34;</span>, save<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div></details>


<div id="plotly-001"></div>

<script>
  Plotly.newPlot(document.getElementById("plotly-001"), {"data":[{"hovertemplate":"%{y}","legendgroup":"Lisbon","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Lisbon","orientation":"v","showlegend":true,"type":"scatter","x":["2020-01-01","2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[0.06434668417596845,0.21011162179908072,0.21405121470781352,0,0.0026263952724885353,0.03151674326986209,0.12803676953381482,0.14182534471437946,0.4681549573210768,0.4458305975049245,0.10505581089954041,0.10833880499015103,0.13854235062376885,0.2225869993434012,0.3873933026920551,0.3782009192383453,0.3755745239658569,0.1831910702560735,0.24425476034143134,0.31516743269862113,0.4727511490479317,0.5370978332239003,0.5843729481286932,0.4569927774130006,0.22849638870650035,0.2337491792514773,0.33092580433355223,0.4254760341431385,0.649376231122784,0.6854891661195008,0.6112934996717005,0.34602757715036114,0.35784635587655944,0.36506894287590275,0.4379514116874589,0.654629021667761,0.7032173342087984,0.6178594878529218,0.30334865397242283,0.417596848325673,0.40052527905449764,0.5206828627708471,0.6868023637557452,0.7367038739330269,0.8647406434668417,0.32173342087984236,0.4057780695994747,0.4031516743269862,0.43992120814182534,0.7209455022980957,0.742613263296126,0.634274458305975,0.3466841759684832,0.4372948128693368,0.4996717005909388,0.6723571897570584,1,0.9304005252790544,0.8181221273801706],"yaxis":"y"},{"hovertemplate":"%{y}","legendgroup":"Accra","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"Accra","orientation":"v","showlegend":true,"type":"scatter","x":["2020-01-01","2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[0.17204301075268813,0.17921146953405015,0,0.33333333333333337,0.43727598566308246,0.3548387096774194,0.21863799283154123,0.2831541218637993,0.18637992831541217,0.20788530465949817,0.3046594982078853,0.3691756272401433,0.3870967741935484,0.4838709677419355,0.4121863799283154,0.30107526881720426,0.2258064516129032,0.35125448028673834,0.3906810035842294,0.45878136200716846,0.5770609318996416,0.5734767025089605,0.4336917562724014,0.38351254480286734,0.49103942652329746,0.5734767025089605,0.5663082437275986,0.6057347670250895,0.6451612903225806,0.5304659498207885,0.3584229390681003,0.5878136200716846,0.8064516129032259,0.7168458781362007,0.7383512544802867,0.6666666666666666,0.5483870967741935,0.3046594982078853,0.6738351254480287,0.7491039426523297,0.5627240143369175,0.7491039426523297,0.6487455197132617,0.7491039426523297,0.5412186379928315,0.7025089605734767,0.7741935483870969,0.888888888888889,0.878136200716846,0.8279569892473119,0.992831541218638,0.5591397849462365,0.8172043010752689,0.7455197132616488,0.7526881720430106,0.7347670250896058,0.9999999999999999,0.8028673835125447,0.4659498207885304],"yaxis":"y"}],"layout":{"height":600,"hovermode":"x","legend":{"orientation":"h","tracegroupgap":0,"x":0.05,"y":1.05},"shapes":[{"line":{"color":"white","dash":"dash","width":2},"type":"line","x0":"2020-02-21","x1":"2020-02-21","xref":"x","y0":0,"y1":1,"yref":"y domain"}],"template":{"data":{"bar":[{"error_x":{"color":"#f2f5fa"},"error_y":{"color":"#f2f5fa"},"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"baxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"line":{"color":"#283442"}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"line":{"color":"#283442"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#506784"},"line":{"color":"rgb(17,17,17)"}},"header":{"fill":{"color":"#2a3f5f"},"line":{"color":"rgb(17,17,17)"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#f2f5fa","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"sequentialminus":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#f2f5fa"},"geo":{"bgcolor":"rgb(17,17,17)","lakecolor":"rgb(17,17,17)","landcolor":"rgb(17,17,17)","showlakes":true,"showland":true,"subunitcolor":"#506784"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"dark"},"paper_bgcolor":"rgb(17,17,17)","plot_bgcolor":"rgb(17,17,17)","polar":{"angularaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","radialaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"yaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"zaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"}},"shapedefaults":{"line":{"color":"#f2f5fa"}},"sliderdefaults":{"bgcolor":"#C8D4E3","bordercolor":"rgb(17,17,17)","borderwidth":1,"tickwidth":0},"ternary":{"aaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"baxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","caxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"title":{"x":0.05},"updatemenudefaults":{"bgcolor":"#506784","borderwidth":0},"xaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2}}},"title":{"text":"Correlation: Lisbon vs Accra\u003cbr\u003e\u003csup\u003eAccra: 0.48\u003c/sup\u003e\u003c/br\u003e","x":0.5},"width":900,"xaxis":{"anchor":"y","domain":[0,1],"hoverformat":"%a, %b %d, %Y","title":{"text":"Date"}},"yaxis":{"anchor":"x","domain":[0,1],"title":{"text":"Scaled Axis"}}}});
</script>
<p>The default implemented strategy saves <code>plotly</code> figures as <code>html</code> code to be viewable aside of the iPython environment.
However if one is interested in more uniform way of storage, here is the function to save <code>html</code> as <code>json</code> without building Plotly figure from scratch.</p>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> plotly
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plotly_html_to_json</span>(name: str) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">.html&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>        html <span style="color:#f92672">=</span> file<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>    call_arg_str <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;Plotly\.newPlot\((.*)\)&#34;</span>, html[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">16</span>:])[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    call_args <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>call_arg_str<span style="color:#e6db74">}</span><span style="color:#e6db74">]&#39;</span>)
</span></span><span style="display:flex;"><span>    plotly_json <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;data&#39;</span>: call_args[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;layout&#39;</span>: call_args[<span style="color:#ae81ff">2</span>]}    
</span></span><span style="display:flex;"><span>    figure <span style="color:#f92672">=</span> plotly<span style="color:#f92672">.</span>io<span style="color:#f92672">.</span>from_json(json<span style="color:#f92672">.</span>dumps(plotly_json))
</span></span><span style="display:flex;"><span>    figure<span style="color:#f92672">.</span>write_json(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">.json&#34;</span>)
</span></span></code></pre></div></details>
<p>Key findings:</p>
<ul>
<li>There is a steadily growing trend for both cities</li>
<li>There is different seasonality for cities:
<ul>
<li>additive weekly seasonality for Lisbon (Thursday, Friday - max, Sunday - min)</li>
<li>for Accra it&rsquo;s no so explicit, and the pattern is different (the maximum is often reached on weekends, and Friday is min)</li>
</ul>
</li>
<li>There are different change points for cities:
<ul>
<li>For Lisbon since the beginning of February the increasing trend was replaced by flatten one</li>
<li>For Accra the trend is more subtle, but given the difference in absolute number the confidence is such a trend much lower</li>
</ul>
</li>
<li>There are outliers:
<ul>
<li>For Lisbon Feb 26 is enormously higher, the reason could be the national holiday - carnival on Feb 25</li>
<li>In addition Feb 14 - not a public holiday but a nice time to have a romantic dinner at home by candlelight</li>
<li>For Accra Feb 7 is enormously lower, could be the object for detailed analysis (a bit covered below)</li>
<li>Moreover for Accra Feb 26 is the maximum for Ghana as well, may be some promo took place for both cities</li>
<li>And the last point of data should be the minimum for Accra, but anyway looks too low, might be the dataset doesn&rsquo;t include all the orders until the end of the day</li>
</ul>
</li>
</ul>
<h3 id="outliers-investigation">Outliers Investigation<a hidden class="anchor" aria-hidden="true" href="#outliers-investigation">#</a></h3>
<p>To interpret outliers one of the possible options is to explore Delivery Success rate</p>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>db<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WITH temp AS (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    SELECT &#34;Created Date&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ,&#34;City&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ,&#34;Order State&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ,COUNT(&#34;Order ID&#34;) as &#34;Orders Count&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    FROM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            orders o
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    WHERE &#34;City&#34; in (&#39;Accra&#39;, &#39;Lisbon&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        AND &#34;Created Date&#34; IN (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;06.02.2020&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;07.02.2020&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;08.02.2020&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;26.02.2020&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;27.02.2020&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;28.02.2020&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    GROUP BY ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">totals AS (
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    SELECT &#34;Created Date&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ,&#34;City&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ,SUM(&#34;Orders Count&#34;) AS &#34;Orders Total&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    FROM temp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    GROUP BY 1, 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SELECT temp.*, 100 * ROUND(&#34;Orders Count&#34;/&#34;Orders Total&#34;, 4) AS &#34;Share&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">FROM temp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">JOIN totals
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USING (&#34;Created Date&#34;, &#34;City&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ORDER BY ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>)<span style="color:#f92672">.</span>to_df()
</span></span></code></pre></div></details>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table>
<thead>
<tr>
<th></th>
<th>Created Date</th>
<th>City</th>
<th>Order State</th>
<th>Orders Count</th>
<th>Share</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>06.02.2020</td>
<td>Accra</td>
<td>delivered</td>
<td>229</td>
<td>91.60</td>
</tr>
<tr>
<td>1</td>
<td>06.02.2020</td>
<td>Accra</td>
<td>failed</td>
<td>11</td>
<td>4.40</td>
</tr>
<tr>
<td>2</td>
<td>06.02.2020</td>
<td>Accra</td>
<td>rejected</td>
<td>10</td>
<td>4.00</td>
</tr>
<tr>
<td>3</td>
<td>06.02.2020</td>
<td>Lisbon</td>
<td>delivered</td>
<td>1855</td>
<td>98.78</td>
</tr>
<tr>
<td>4</td>
<td>06.02.2020</td>
<td>Lisbon</td>
<td>failed</td>
<td>1</td>
<td>0.05</td>
</tr>
<tr>
<td>5</td>
<td>06.02.2020</td>
<td>Lisbon</td>
<td>rejected</td>
<td>22</td>
<td>1.17</td>
</tr>
<tr>
<td>6</td>
<td>07.02.2020</td>
<td>Accra</td>
<td>delivered</td>
<td>161</td>
<td>86.10</td>
</tr>
<tr>
<td>7</td>
<td>07.02.2020</td>
<td>Accra</td>
<td>failed</td>
<td>23</td>
<td>12.30</td>
</tr>
<tr>
<td>8</td>
<td>07.02.2020</td>
<td>Accra</td>
<td>rejected</td>
<td>3</td>
<td>1.60</td>
</tr>
<tr>
<td>9</td>
<td>07.02.2020</td>
<td>Lisbon</td>
<td>delivered</td>
<td>1725</td>
<td>99.19</td>
</tr>
<tr>
<td>10</td>
<td>07.02.2020</td>
<td>Lisbon</td>
<td>failed</td>
<td>4</td>
<td>0.23</td>
</tr>
<tr>
<td>11</td>
<td>07.02.2020</td>
<td>Lisbon</td>
<td>rejected</td>
<td>10</td>
<td>0.58</td>
</tr>
<tr>
<td>12</td>
<td>08.02.2020</td>
<td>Accra</td>
<td>delivered</td>
<td>264</td>
<td>95.65</td>
</tr>
<tr>
<td>13</td>
<td>08.02.2020</td>
<td>Accra</td>
<td>failed</td>
<td>4</td>
<td>1.45</td>
</tr>
<tr>
<td>14</td>
<td>08.02.2020</td>
<td>Accra</td>
<td>rejected</td>
<td>8</td>
<td>2.90</td>
</tr>
<tr>
<td>15</td>
<td>08.02.2020</td>
<td>Lisbon</td>
<td>delivered</td>
<td>1246</td>
<td>99.12</td>
</tr>
<tr>
<td>16</td>
<td>08.02.2020</td>
<td>Lisbon</td>
<td>failed</td>
<td>6</td>
<td>0.48</td>
</tr>
<tr>
<td>17</td>
<td>08.02.2020</td>
<td>Lisbon</td>
<td>rejected</td>
<td>5</td>
<td>0.40</td>
</tr>
<tr>
<td>18</td>
<td>26.02.2020</td>
<td>Accra</td>
<td>delivered</td>
<td>355</td>
<td>96.47</td>
</tr>
<tr>
<td>19</td>
<td>26.02.2020</td>
<td>Accra</td>
<td>failed</td>
<td>6</td>
<td>1.63</td>
</tr>
<tr>
<td>20</td>
<td>26.02.2020</td>
<td>Accra</td>
<td>rejected</td>
<td>7</td>
<td>1.90</td>
</tr>
<tr>
<td>21</td>
<td>26.02.2020</td>
<td>Lisbon</td>
<td>delivered</td>
<td>2307</td>
<td>98.84</td>
</tr>
<tr>
<td>22</td>
<td>26.02.2020</td>
<td>Lisbon</td>
<td>failed</td>
<td>8</td>
<td>0.34</td>
</tr>
<tr>
<td>23</td>
<td>26.02.2020</td>
<td>Lisbon</td>
<td>rejected</td>
<td>19</td>
<td>0.81</td>
</tr>
<tr>
<td>24</td>
<td>27.02.2020</td>
<td>Accra</td>
<td>delivered</td>
<td>300</td>
<td>92.31</td>
</tr>
<tr>
<td>25</td>
<td>27.02.2020</td>
<td>Accra</td>
<td>failed</td>
<td>13</td>
<td>4.00</td>
</tr>
<tr>
<td>26</td>
<td>27.02.2020</td>
<td>Accra</td>
<td>rejected</td>
<td>12</td>
<td>3.69</td>
</tr>
<tr>
<td>27</td>
<td>27.02.2020</td>
<td>Lisbon</td>
<td>delivered</td>
<td>2201</td>
<td>98.79</td>
</tr>
<tr>
<td>28</td>
<td>27.02.2020</td>
<td>Lisbon</td>
<td>failed</td>
<td>6</td>
<td>0.27</td>
</tr>
<tr>
<td>29</td>
<td>27.02.2020</td>
<td>Lisbon</td>
<td>rejected</td>
<td>21</td>
<td>0.94</td>
</tr>
<tr>
<td>30</td>
<td>28.02.2020</td>
<td>Accra</td>
<td>delivered</td>
<td>206</td>
<td>85.83</td>
</tr>
<tr>
<td>31</td>
<td>28.02.2020</td>
<td>Accra</td>
<td>failed</td>
<td>17</td>
<td>7.08</td>
</tr>
<tr>
<td>32</td>
<td>28.02.2020</td>
<td>Accra</td>
<td>rejected</td>
<td>17</td>
<td>7.08</td>
</tr>
<tr>
<td>33</td>
<td>28.02.2020</td>
<td>Lisbon</td>
<td>delivered</td>
<td>2030</td>
<td>98.88</td>
</tr>
<tr>
<td>34</td>
<td>28.02.2020</td>
<td>Lisbon</td>
<td>failed</td>
<td>7</td>
<td>0.34</td>
</tr>
<tr>
<td>35</td>
<td>28.02.2020</td>
<td>Lisbon</td>
<td>rejected</td>
<td>16</td>
<td>0.78</td>
</tr>
</tbody>
</table>
</div>
<p>If you&rsquo;re a fan of <code>pandas</code> of course it may be easier to apply similar operations within familiar package, and it even may seem as more Pythonic way to do so, although believe me, once you start using <code>duckdb</code>, it turns out that some operations are just more native to SQL like complex joins and window functions and you naturally perform them faster in SQL; work smarter, not harder - if you&rsquo;re inventing a bicycle writing SQL alike transformations in Pandas, nobody beyond your internal perfectionist will reward it.</p>
<h4 id="pandas-alternative">Pandas alternative<a hidden class="anchor" aria-hidden="true" href="#pandas-alternative">#</a></h4>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>temp <span style="color:#f92672">=</span> orders[
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;City&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Accra&#34;</span>) <span style="color:#f92672">|</span> 
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;City&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Lisbon&#34;</span>)
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">&amp;</span>
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;Created Date&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;06.02.2020&#39;</span>) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;Created Date&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;07.02.2020&#39;</span>) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;Created Date&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;08.02.2020&#39;</span>) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;Created Date&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;26.02.2020&#39;</span>) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;Created Date&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;27.02.2020&#39;</span>) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>        (orders[<span style="color:#e6db74">&#34;Created Date&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;28.02.2020&#39;</span>) 
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>]<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#34;Created Date&#34;</span>, <span style="color:#e6db74">&#34;City&#34;</span>, <span style="color:#e6db74">&#34;Order State&#34;</span>])<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#34;Order ID&#34;</span>: <span style="color:#e6db74">&#34;count&#34;</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>temp<span style="color:#f92672">.</span>join(
</span></span><span style="display:flex;"><span>    temp<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#34;Created Date&#34;</span>, <span style="color:#e6db74">&#34;City&#34;</span>])<span style="color:#f92672">.</span>sum(), on<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;Created Date&#34;</span>, <span style="color:#e6db74">&#34;City&#34;</span>], rsuffix<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; Total&#34;</span>
</span></span><span style="display:flex;"><span>)<span style="color:#f92672">.</span>apply(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">lambda</span> x: <span style="color:#ae81ff">100</span> <span style="color:#f92672">*</span> round(x[<span style="color:#e6db74">&#34;Order ID&#34;</span>] <span style="color:#f92672">/</span> x[<span style="color:#e6db74">&#34;Order ID Total&#34;</span>], <span style="color:#ae81ff">4</span>), axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div></details>
<p><strong>Insight</strong>: Quick analysis for Feb 7 and for Feb 28 shows that the percentage of delivered orders in Accra is lower than usual while for Lisbon there is no such a drop, that is one of the potential reason of outliers</p>
<h2 id="make-a-forecast-of-the-number-of-orders-expected-in-the-following-4-weeks">Make a forecast of the number of orders expected in the following 4 weeks<a hidden class="anchor" aria-hidden="true" href="#make-a-forecast-of-the-number-of-orders-expected-in-the-following-4-weeks">#</a></h2>
<p>The correlation between two cities is not that high (Pearson coef is less than 0.5) to leverage it, providing the other country as a predictor</p>
<h3 id="portugal-lisbon">Portugal (Lisbon)<a hidden class="anchor" aria-hidden="true" href="#portugal-lisbon">#</a></h3>
<h4 id="fit">Fit<a hidden class="anchor" aria-hidden="true" href="#fit">#</a></h4>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>model <span style="color:#f92672">=</span> Prophet(pivot[<span style="color:#e6db74">&#34;Lisbon&#34;</span>]<span style="color:#f92672">.</span>reset_index(), y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Lisbon&#34;</span>, date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;date&#34;</span>, test_days<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>)
</span></span></code></pre></div></details>
<p>Incorporate all the logic described within the previous point:</p>
<ul>
<li>linear trend</li>
<li>weekly additive seasonality</li>
<li>Carnival, Valentine Day as outliers</li>
</ul>
<p>Last week as a validation time frame</p>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>model<span style="color:#f92672">.</span>run(
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linear&#39;</span>,
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    monthly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    seasonality_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>,
</span></span><span style="display:flex;"><span>    country_holidays<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PT&#39;</span>,
</span></span><span style="display:flex;"><span>    outliers<span style="color:#f92672">=</span>[(<span style="color:#e6db74">&#34;2020-02-13&#34;</span>, <span style="color:#e6db74">&#34;2020-02-15&#34;</span>)]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>show(
</span></span><span style="display:flex;"><span>    title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Lisbon&#34;</span>,
</span></span><span style="display:flex;"><span>    y_label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Orders, #&#34;</span>,
</span></span><span style="display:flex;"><span>    save<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div></details>


<div id="plotly-002"></div>

<script>
  Plotly.newPlot(document.getElementById("plotly-002"), {"data":[{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","legendgrouptitle":{"text":"Actual vs Expected"},"line":{"color":"white"},"name":"Expected Value","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[1216.243884500029,1140.059292536731,734.9110863257586,802.6231228988607,855.6229348030836,1006.0539015498298,1258.810209128002,1364.2645763005735,1288.079984478382,882.9317782732235,950.6438148784396,1003.6436264695808,1154.0745927753517,1406.8309000634235,1512.2825617957258,1436.0952644125275,1030.9443438994547,1098.6340304381645,1151.6114923071714,1302.009817212394,1551.4937780191149,1653.675798422626,1574.1995173677303,1165.7390865394582,1230.1388985216906,1279.8124579618543,1426.9171722600177,1676.338828044882,1768.3072433250513,1678.6366994908083,1259.9856867789622,1314.172391768569,1353.6468720880453,1490.53979679887,1729.7382253895998,1821.6347135762378,1731.891558560321,1313.1842056640226,1367.3370955795872,1406.777760865098,1543.6495810086194,1782.8467421352257,1874.7419628575904,1784.9982244644568,1366.2908716076129,1420.4437615631016,1459.8844268485166,1596.7562469923068,1835.9534081191287,1927.8486288402673,1838.1048904474915,1419.3975375915963,1473.5504275466155,1512.9910928315642,1649.8629129755807,1889.0600741022822,1980.9552948237508,1891.211556430526],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Upper bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[1371.803307653251,1297.4250075212933,908.4970467758201,956.4471649967048,1016.9344052903942,1150.9543485587512,1409.5566696022279,1513.078737658222,1435.1913772396426,1047.9340716753645,1102.7512367386414,1163.4481610394196,1298.850348684941,1560.6130026019011,1678.4706292018957,1588.889443304823,1195.5269061788476,1261.1351528041591,1308.2375637749171,1457.3601864791067,1698.3351429213915,1813.180568480154,1739.0991909265567,1309.6511007230406,1391.437915832164,1439.748115872009,1581.3955304412634,1826.0889788818827,1927.8683767138045,1831.6508342522022,1414.2719639938016,1464.2785034806968,1507.6678528819932,1641.6649856408885,1890.4705077241406,1975.9918158390406,1871.9039983598896,1466.85042210563,1515.0871370839059,1552.1892566669649,1696.5396452117777,1943.7988269891289,2028.7137137223601,1941.7783521563995,1521.5262806311007,1590.4521199930791,1599.0443993707613,1767.738324423305,1986.8121577808897,2089.4696985641995,1992.3072647520767,1575.866312173787,1637.9482802170428,1673.340618480868,1806.0017713387863,2041.2846547094218,2130.3545821416983,2053.107048793406],"yaxis":"y"},{"connectgaps":true,"fill":"tonexty","hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Lower bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[1067.7188011395926,977.1808438965842,579.77162628669,649.6345305314446,719.1487251785006,844.9667661812663,1099.999136630989,1207.8968631965759,1126.9393899637303,738.1191147487706,800.4718119607645,854.9347694937079,996.3610728755458,1251.5826244972848,1362.6235786000575,1270.94081066004,869.429590342256,945.5188482786144,998.3286236596099,1157.899913181501,1391.4011988202883,1494.5582092988361,1427.104797670658,1007.7917817080227,1071.1926179245074,1121.992204087374,1271.4620231348567,1518.239265863053,1614.9519891361922,1521.3608251264775,1114.3649751830296,1158.6629468386816,1195.5967896897707,1336.4306198801642,1580.844415982795,1663.7197225713896,1584.4030234195664,1148.3159084330198,1216.6903656157365,1253.18654809785,1381.1353853024902,1624.1280389127976,1729.3886101712385,1631.9485930007118,1218.2429823490338,1267.0467526920309,1293.5079036977922,1438.122415676453,1682.6744717275703,1779.0417188073272,1682.746082909982,1263.450734976723,1322.8036234147214,1360.3647590115334,1507.145324065174,1730.1545790212845,1821.558119251838,1742.8324538039215],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"red"},"name":"Actual","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[1104,1110,784,788,832,979,1000,1497,1463,944,949,995,1123,1374,1360,1356,1063,1156,1264,1504,1602,1674,1480,1132,1140,1288,1432,1773,1828,1715,1311,1329,1340,1451,1781,1855,1725,1246,1420,1394,1577,1830,1906,2101,1274,1402,1398,1454,1882,1915,1750,1312,1450,1545,1808,2307,2201,2030],"yaxis":"y"}],"layout":{"height":600,"hovermode":"x","legend":{"groupclick":"toggleitem","orientation":"h","traceorder":"grouped","x":0,"y":-0.2},"shapes":[{"line":{"color":"white","dash":"dash","width":2},"type":"line","x0":"2020-02-21","x1":"2020-02-21","xref":"x","y0":0,"y1":1,"yref":"y domain"}],"template":{"data":{"bar":[{"error_x":{"color":"#f2f5fa"},"error_y":{"color":"#f2f5fa"},"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"baxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"line":{"color":"#283442"}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"line":{"color":"#283442"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#506784"},"line":{"color":"rgb(17,17,17)"}},"header":{"fill":{"color":"#2a3f5f"},"line":{"color":"rgb(17,17,17)"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#f2f5fa","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"sequentialminus":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#f2f5fa"},"geo":{"bgcolor":"rgb(17,17,17)","lakecolor":"rgb(17,17,17)","landcolor":"rgb(17,17,17)","showlakes":true,"showland":true,"subunitcolor":"#506784"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"dark"},"paper_bgcolor":"rgb(17,17,17)","plot_bgcolor":"rgb(17,17,17)","polar":{"angularaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","radialaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"yaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"zaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"}},"shapedefaults":{"line":{"color":"#f2f5fa"}},"sliderdefaults":{"bgcolor":"#C8D4E3","bordercolor":"rgb(17,17,17)","borderwidth":1,"tickwidth":0},"ternary":{"aaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"baxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","caxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"title":{"x":0.05},"updatemenudefaults":{"bgcolor":"#506784","borderwidth":0},"xaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2}}},"title":{"text":"Lisbon","x":0.5},"width":900,"xaxis":{"anchor":"y","domain":[0,1],"hoverformat":"%a, %b %d, %Y","title":{"text":"Date"}},"yaxis":{"anchor":"x","domain":[0,1],"title":{"text":"Orders, #"}}}});
</script>
<p><strong>Summary</strong>: model fits well, the last week expectedly exceeds the upper bounds due to the holiday</p>
<h4 id="predict">Predict<a hidden class="anchor" aria-hidden="true" href="#predict">#</a></h4>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>libon <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">36</span>)<span style="color:#f92672">.</span>join(pivot[<span style="color:#e6db74">&#34;Lisbon&#34;</span>], on<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> Prophet(libon, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Lisbon&#34;</span>, date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ds&#34;</span>, test_days<span style="color:#f92672">=</span><span style="color:#ae81ff">28</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>run(
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linear&#39;</span>,
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    monthly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    seasonality_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>,
</span></span><span style="display:flex;"><span>    country_holidays<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PT&#39;</span>,
</span></span><span style="display:flex;"><span>    outliers<span style="color:#f92672">=</span>[(<span style="color:#e6db74">&#34;2020-02-13&#34;</span>, <span style="color:#e6db74">&#34;2020-02-15&#34;</span>)]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>show(
</span></span><span style="display:flex;"><span>    title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Lisbon Prognosis&#34;</span>,
</span></span><span style="display:flex;"><span>    y_label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Orders, #&#34;</span>,
</span></span><span style="display:flex;"><span>    save<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div></details>


<div id="plotly-003"></div>

<script>
  Plotly.newPlot(document.getElementById("plotly-003"), {"data":[{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","legendgrouptitle":{"text":"Actual vs Expected"},"line":{"color":"white"},"name":"Expected Value","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[1246.6556926790186,1141.9693885059116,730.3965638903242,805.9613836711297,863.2807542994694,1026.8607419778032,1309.0572552282715,1382.650954699268,1277.96465050796,866.3918258473259,941.9566455846938,999.2760154517458,1162.856002365523,1445.0525148495494,1518.644325959603,1413.9561334066861,1002.3769963411257,1077.935503673733,1135.2339018923494,1298.7624583414024,1580.9075403598454,1649.2842737097073,1539.3810033963503,1122.5796020632893,1192.9158451282392,1244.9961652324478,1403.3072647561437,1680.2348898508399,1746.0507293912165,1633.5865652699094,1214.2093292658737,1281.9697376618165,1331.4719350781193,1487.2238884067438,1761.5923673050831,1827.3579721019812,1714.843573236586,1295.4426539148458,1363.1793789924623,1412.670654917537,1568.4225479175268,1842.7909664886406,1908.5565712771172,1796.042172402627,1376.6412530714497,1444.377978155189,1493.8692540977413,1649.6211471053405,1923.9895656839553,1989.7551704862542,1877.2407716271487,1457.8398523119577,1525.576577395288,1575.067853337331,1730.8197463451902,2005.1881649236673,2070.953769726413,1958.43937086672,1539.038451551537,1606.7751766345007,1656.2664525777175,1812.0183455850406,2086.386764162751,2152.1523689661435,2039.6379701062212,1620.237050791238,1687.9737758745991,1737.46505181688,1893.2169448248903,2167.585363402463,2233.3509682061213,2120.8365693458627,1701.4356500309389,1769.172375114121,1818.6636510568678,1974.4155440651698,2248.783962642926,2314.5495674460994,2202.0351685868204,1782.6342492706394,1850.3709743542195,1899.8622502964577,2055.61414330459,2329.98256188201,2395.748166685583,2283.2337678263916],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Upper bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[1464.2642612402706,1339.3413429780367,917.2683972444364,1010.1345489522935,1052.9872301038217,1219.091221981837,1504.4214026674024,1587.0818848170577,1476.3707290399418,1059.6814525154352,1149.938919228951,1197.7505661967928,1344.2446461369555,1629.3584752624527,1711.8074513917838,1591.633021773172,1188.637690924938,1277.8774589884997,1341.644072374381,1504.48967631043,1758.931565451844,1842.5152664352102,1728.822537835987,1299.5777774112385,1383.7486038535349,1437.5407070767549,1585.7726635522777,1867.7881170455846,1937.3565811123613,1822.0061680840913,1414.664567864773,1474.7075011616996,1526.2119986493449,1678.4971061271478,1958.6386669414173,2026.0744684822378,1920.975481693178,1490.7489588176215,1564.1895624962924,1605.4237001033637,1751.1366398342857,2026.2110423204222,2084.6248922426844,1984.9259061262105,1574.7089669634574,1635.0562495196432,1695.6439974467069,1839.0363700120367,2134.0306191504733,2187.8053164517883,2082.5637956973274,1656.0463784614199,1728.6554124576905,1769.1784383426557,1903.2693789466625,2197.182610109146,2263.166154049372,2139.224402995898,1730.4483601271138,1793.6583484650073,1853.3911254452426,1996.934770786015,2278.6688492601306,2351.319604750738,2229.6154558596927,1836.3167314980903,1877.745979346405,1935.8184435141147,2081.608264187633,2362.0426871093564,2417.7920889763705,2310.352129707099,1911.129969033225,1977.1170817624982,2002.8283495821056,2164.7656801994576,2437.9989431551917,2488.1292855013917,2399.6071143702125,1963.881994080171,2054.1023242721985,2104.3281593874062,2256.936582497208,2516.5555489534913,2577.7210071545787,2476.3333620665426],"yaxis":"y"},{"connectgaps":true,"fill":"tonexty","hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Lower bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[1050.4628780973846,961.2662031244093,535.6881232313303,620.310632936025,674.3836347059905,842.9058733917234,1104.86501249334,1180.9658569015135,1079.1234997121912,674.3905320762484,748.0000513261165,809.0283185550095,952.5874557654596,1258.2632901605598,1324.1179951827687,1215.063671041371,807.2979733012317,899.3952271843663,932.5278988555538,1107.951144166893,1385.038416913796,1453.9633331737957,1349.601670832068,941.0632391243429,1019.0100921687684,1047.3325170630083,1203.0667832634965,1491.3864156634309,1554.6977856363808,1445.5457783142435,1036.5473575561575,1102.5775773566618,1132.0330344965614,1301.3586812782728,1569.414113449985,1650.0224584736086,1517.8003776669661,1091.905263144633,1170.5838451633767,1220.2110119917022,1379.9185225614904,1647.876719605743,1719.530088265685,1595.7581138970002,1180.294522537108,1258.284796300566,1311.2685707098776,1467.7937221621419,1724.4370639147173,1805.567821489471,1694.043448412933,1253.6045524538408,1331.8375103333492,1387.2129875952664,1534.8132520361835,1816.836828715864,1871.7132822468677,1761.24439072217,1329.0757853157168,1408.9033669810296,1470.7012922738327,1617.6419049339074,1887.0651516878172,1959.9801414815138,1845.7773674489972,1440.8813353140422,1491.172733884841,1534.009473760495,1693.6908200055698,1957.4354024831966,2040.3707089014827,1923.2224425867657,1510.5495480509167,1564.6943631490974,1625.5751200950901,1779.9059203001846,2062.546065793413,2119.2893161389416,2015.699732738456,1571.671198080184,1647.4077811259094,1703.5674570920921,1866.2966484732347,2122.9093007165206,2187.713503790082,2085.3213764782327],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"red"},"name":"Actual","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[1104,1110,784,788,832,979,1000,1497,1463,944,949,995,1123,1374,1360,1356,1063,1156,1264,1504,1602,1674,1480,1132,1140,1288,1432,1773,1828,1715,1311,1329,1340,1451,1781,1855,1725,1246,1420,1394,1577,1830,1906,2101,1274,1402,1398,1454,1882,1915,1750,1312,1450,1545,1808,2307,2201,2030,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"yaxis":"y"}],"layout":{"height":600,"hovermode":"x","legend":{"groupclick":"toggleitem","orientation":"h","traceorder":"grouped","x":0,"y":-0.2},"shapes":[{"line":{"color":"white","dash":"dash","width":2},"type":"line","x0":"2020-02-28","x1":"2020-02-28","xref":"x","y0":0,"y1":1,"yref":"y domain"}],"template":{"data":{"bar":[{"error_x":{"color":"#f2f5fa"},"error_y":{"color":"#f2f5fa"},"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"baxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"line":{"color":"#283442"}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"line":{"color":"#283442"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#506784"},"line":{"color":"rgb(17,17,17)"}},"header":{"fill":{"color":"#2a3f5f"},"line":{"color":"rgb(17,17,17)"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#f2f5fa","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"sequentialminus":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#f2f5fa"},"geo":{"bgcolor":"rgb(17,17,17)","lakecolor":"rgb(17,17,17)","landcolor":"rgb(17,17,17)","showlakes":true,"showland":true,"subunitcolor":"#506784"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"dark"},"paper_bgcolor":"rgb(17,17,17)","plot_bgcolor":"rgb(17,17,17)","polar":{"angularaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","radialaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"yaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"zaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"}},"shapedefaults":{"line":{"color":"#f2f5fa"}},"sliderdefaults":{"bgcolor":"#C8D4E3","bordercolor":"rgb(17,17,17)","borderwidth":1,"tickwidth":0},"ternary":{"aaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"baxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","caxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"title":{"x":0.05},"updatemenudefaults":{"bgcolor":"#506784","borderwidth":0},"xaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2}}},"title":{"text":"Lisbon Prognosis","x":0.5},"width":900,"xaxis":{"anchor":"y","domain":[0,1],"hoverformat":"%a, %b %d, %Y","title":{"text":"Date"}},"yaxis":{"anchor":"x","domain":[0,1],"title":{"text":"Orders, #"}}}});
</script>
<h3 id="ghana-accra">Ghana (Accra)<a hidden class="anchor" aria-hidden="true" href="#ghana-accra">#</a></h3>
<p>The same algorithm for Accra</p>
<h4 id="fit-1">Fit<a hidden class="anchor" aria-hidden="true" href="#fit-1">#</a></h4>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>model <span style="color:#f92672">=</span> Prophet(pivot[<span style="color:#e6db74">&#34;Accra&#34;</span>]<span style="color:#f92672">.</span>reset_index(), y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Accra&#34;</span>, date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;date&#34;</span>, test_days<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>)
</span></span></code></pre></div></details>
<p>Incorporate all the logic described within the previous point:</p>
<ul>
<li>linear trend</li>
<li>weekly additive seasonality</li>
<li>Feb 7 &amp; Feb 28 as outliers</li>
</ul>
<p>Last week as a validation time frame</p>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>model<span style="color:#f92672">.</span>run(
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linear&#39;</span>,
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    monthly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    seasonality_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>,
</span></span><span style="display:flex;"><span>    outliers<span style="color:#f92672">=</span>[(<span style="color:#e6db74">&#34;2020-02-06&#34;</span>, <span style="color:#e6db74">&#34;2020-02-08&#34;</span>), (<span style="color:#e6db74">&#34;2020-02-27&#34;</span>, <span style="color:#e6db74">&#34;2020-02-29&#34;</span>)]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>show(
</span></span><span style="display:flex;"><span>    title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Accra&#34;</span>,
</span></span><span style="display:flex;"><span>    y_label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Orders, #&#34;</span>,
</span></span><span style="display:flex;"><span>    save<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div></details>


<div id="plotly-004"></div>

<script>
  Plotly.newPlot(document.getElementById("plotly-004"), {"data":[{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","legendgrouptitle":{"text":"Actual vs Expected"},"line":{"color":"white"},"name":"Expected Value","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[126.53792614004685,90.14790826139017,139.3895594509464,165.5323754141251,158.960969507225,171.53238681908903,161.91988268358602,151.16989194753964,114.77987406687387,164.02152525648862,190.16434122311665,183.59293532033536,196.16435263286016,186.55184850286122,175.80185776783514,139.41183988457072,188.65349106806448,214.7963070255927,208.22490111315568,220.79631841535704,211.18381427733985,200.4338235385521,164.04380564610636,213.28545681536858,239.4282727615747,232.85686683460142,245.42828412636305,235.81577995359234,225.06578917845223,188.6757712551187,237.91742239843921,264.060238319661,257.48883237118304,270.0602496374846,260.4477454562713,249.69775467449912,213.3077367419748,262.5493878754251,288.6922037892301,282.1207978330932,294.69221521899743,285.0797111623456,274.32972050507266,237.93970269939194,287.1813539597117,313.3241699967092,306.75276416391614,319.32418154981264,309.71167749315237,298.96168683587416,262.5716690302523,311.81332029039737,337.95613632750747,331.3847304948053,343.95614788067803,334.3436438240074,323.5936531668637,287.20363536111256],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Upper bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[164.07140754653136,125.19078487193151,175.74548258011066,204.47349891096002,194.18969706374043,207.14953773287246,198.63190873838096,188.08803890226022,152.87050413944948,199.7880093078174,224.57293576680982,221.7144304401045,235.01563951008902,222.70333134345333,214.66261959017038,174.40923685086193,227.50442861956748,251.40332137039212,244.9891336157908,259.7808478478142,249.7278893602578,234.3331505204838,200.23354048554162,250.35299982445636,278.28271576983707,269.4500850113834,280.5408386755103,272.08629114573193,260.89286587118556,226.54532604483157,276.3118066035886,300.5937283862796,295.46385445734217,305.4874871063662,295.5730924513131,287.67934128521046,251.98173500988872,300.64917206393307,326.5083783441093,320.90761892713607,333.99858724781626,320.8144659987981,313.371710600346,276.3109730243058,321.007430825239,347.5517613133096,342.81614166091254,356.6851613119187,348.1128882256459,337.5059032871721,296.3683299407604,349.5678852291547,376.5469679469403,369.2182582922189,380.78629291242845,370.56376325551145,363.5516965293671,325.4698041233334],"yaxis":"y"},{"connectgaps":true,"fill":"tonexty","hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Lower bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[90.89427392975188,53.84398886577575,102.14902877960789,130.54087389001754,124.09698489101517,135.59819744751172,124.07093928485844,114.11821842813569,76.71690621924792,125.73353421255821,153.23935345360522,146.7404694308053,159.16832260809937,149.40587220849284,137.97294775517946,103.23930115928539,152.69619337323095,178.33570283643044,171.77603814779576,182.40520947983114,173.20339717789898,163.18443957398148,129.41985133873646,174.31549848534146,200.86806706556956,196.48359555434988,206.25339851982164,198.45002527981177,186.25522301956406,153.05993653379906,200.00854086562833,227.9005159067847,221.2644281495313,233.52731173436754,221.93965591634046,211.1579106969678,175.08364430786372,226.08663726584237,251.51870583988284,247.10576762074984,260.1306822474275,248.285960863368,236.13630349620342,201.60505483519285,252.01298741622813,273.2650797023116,270.6296698316354,282.2942434787043,274.3120949812776,262.16977583065716,221.95766507449454,276.0337165722057,303.33174391100215,294.0483633900242,307.8094935875986,294.85924015762924,288.46119641262754,251.094162691269],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"red"},"name":"Actual","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28"],"xaxis":"x","y":[126,76,169,198,175,137,155,128,134,161,179,184,211,191,160,139,174,185,204,237,236,197,183,213,236,234,245,256,224,176,240,301,276,282,262,229,161,264,285,233,285,257,285,227,272,292,324,321,307,353,232,304,284,286,281,355,300,206],"yaxis":"y"}],"layout":{"height":600,"hovermode":"x","legend":{"groupclick":"toggleitem","orientation":"h","traceorder":"grouped","x":0,"y":-0.2},"shapes":[{"line":{"color":"white","dash":"dash","width":2},"type":"line","x0":"2020-02-21","x1":"2020-02-21","xref":"x","y0":0,"y1":1,"yref":"y domain"}],"template":{"data":{"bar":[{"error_x":{"color":"#f2f5fa"},"error_y":{"color":"#f2f5fa"},"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"baxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"line":{"color":"#283442"}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"line":{"color":"#283442"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#506784"},"line":{"color":"rgb(17,17,17)"}},"header":{"fill":{"color":"#2a3f5f"},"line":{"color":"rgb(17,17,17)"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#f2f5fa","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"sequentialminus":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#f2f5fa"},"geo":{"bgcolor":"rgb(17,17,17)","lakecolor":"rgb(17,17,17)","landcolor":"rgb(17,17,17)","showlakes":true,"showland":true,"subunitcolor":"#506784"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"dark"},"paper_bgcolor":"rgb(17,17,17)","plot_bgcolor":"rgb(17,17,17)","polar":{"angularaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","radialaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"yaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"zaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"}},"shapedefaults":{"line":{"color":"#f2f5fa"}},"sliderdefaults":{"bgcolor":"#C8D4E3","bordercolor":"rgb(17,17,17)","borderwidth":1,"tickwidth":0},"ternary":{"aaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"baxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","caxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"title":{"x":0.05},"updatemenudefaults":{"bgcolor":"#506784","borderwidth":0},"xaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2}}},"title":{"text":"Accra","x":0.5},"width":900,"xaxis":{"anchor":"y","domain":[0,1],"hoverformat":"%a, %b %d, %Y","title":{"text":"Date"}},"yaxis":{"anchor":"x","domain":[0,1],"title":{"text":"Orders, #"}}}});
</script>
<p><strong>Summary</strong>: model fits well, but the last week exceeds the lower bounds of CI, as it was explored below one of the reason is the drop in the delivery success rate, anyway let&rsquo;s take into account this week for the forecast for March.</p>
<h4 id="predict-1">Predict<a hidden class="anchor" aria-hidden="true" href="#predict-1">#</a></h4>
<details>
<summary>Code</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>accra <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>model<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">36</span>)<span style="color:#f92672">.</span>join(pivot[<span style="color:#e6db74">&#34;Accra&#34;</span>], on<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> Prophet(accra, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Accra&#34;</span>, date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ds&#34;</span>, test_days<span style="color:#f92672">=</span><span style="color:#ae81ff">28</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>run(
</span></span><span style="display:flex;"><span>    growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linear&#39;</span>,
</span></span><span style="display:flex;"><span>    yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    monthly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>    seasonality_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>,
</span></span><span style="display:flex;"><span>    outliers<span style="color:#f92672">=</span>[(<span style="color:#e6db74">&#34;2020-02-06&#34;</span>, <span style="color:#e6db74">&#34;2020-02-08&#34;</span>), (<span style="color:#e6db74">&#34;2020-02-27&#34;</span>, <span style="color:#e6db74">&#34;2020-02-29&#34;</span>)]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>show(
</span></span><span style="display:flex;"><span>    title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Accra Prognosis&#34;</span>,
</span></span><span style="display:flex;"><span>    y_label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Orders, #&#34;</span>,
</span></span><span style="display:flex;"><span>    save<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div></details>


<div id="plotly-005"></div>

<script>
  Plotly.newPlot(document.getElementById("plotly-005"), {"data":[{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","legendgrouptitle":{"text":"Actual vs Expected"},"line":{"color":"white"},"name":"Expected Value","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[132.64269774741885,92.9970396767499,146.03577500645963,166.39499973888485,160.90878414770373,171.27999439508832,170.7528547838579,155.10919036749272,115.46353229480158,168.5022676268109,188.86149236138016,183.37527676952396,193.74648701531007,193.2193474026218,177.57568298603127,137.9300249132519,190.9687602423409,211.32798497402464,205.84176937824145,216.212967832271,215.6858164278897,200.04213993995845,160.39646979591427,213.43483175115082,233.79368310884632,228.3069773023124,238.67488262691344,238.14443809285316,222.49610623894472,182.84578072893333,235.87901761652,256.23274390636635,250.74080140459915,261.1050497215504,260.57094817995727,244.9198829706747,205.26682410499075,258.29815864223315,278.64998069441793,273.15636242220603,283.52016998628596,282.98562769211435,267.3345605929598,227.68149983862708,280.712832487226,301.06465453853355,295.571036265577,305.93484383148285,305.40030153890586,289.74923444142223,250.09617368761803,303.12750633655844,323.479328387984,317.985710115114,328.3495176810037,327.81497538842285,312.1639082910612,272.5108475371226,325.5421801861212,345.8940022375464,340.40038396451865,350.76419153052456,350.2296492379507,334.57858214052555,294.92552138661046,347.956854035641,368.30867608699685,362.8150578141089,373.17886538004535,372.6443230874677,356.9932559899774,317.3401952361319,370.3715278851608,390.7233499365684,385.2297316635798,395.5935392295075,395.05899693690543,379.40792983942924,339.7548690855909,392.7862017346807,413.1380237860189,407.64440551311674,418.008213079087,417.4736707864333,401.8226036889063,362.1695429350954],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Upper bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[176.561348420956,131.56943341878474,185.96072662346987,209.25419287754667,203.16455407673388,207.68020147329634,214.58362446777653,198.41274641779256,156.6936859429182,206.6658990066203,230.66690419347933,226.67586275182416,235.41701814595635,236.82453757686642,218.8630635152222,181.40373097127892,233.83918224618523,251.25986984260373,246.13653083305243,258.4056111129209,257.80623729192905,240.3740496345762,203.64323118895712,253.88987812769537,275.0435905542832,271.46213942141867,279.9471345955265,276.7964507909828,266.11345491802484,224.0069691288307,279.87374995713424,297.2738341809409,293.4329064955739,303.1702472830369,299.7261128012311,286.69249865917453,244.7692614125986,300.8350773476682,319.76365214158494,315.0119833911256,323.1269994265942,324.64874777415764,308.54241648643375,270.20912168527764,324.76846295309406,341.14542688101074,335.9850322088996,345.8691844028904,347.9864061698364,331.7371468990643,290.7726190492754,343.7388697088713,366.6593140097227,360.94960523064077,370.04472358582325,368.2438699393053,351.12843610062345,313.10690863078503,365.5618958969517,384.4901410415004,381.80759863433,393.49922186744635,390.97977043890063,376.52153990832176,336.9741037351438,386.34136326733807,405.9445075314705,404.44702368885095,416.4872927192653,416.07762624243696,400.56122140839557,359.43109738837086,409.78888316139177,432.6211474134809,425.75365733271275,436.03715783274237,435.31005096592037,421.44542985084803,379.2731610594649,436.4752528677008,455.647529809516,449.9763587346519,456.5330556599652,459.74427799405,446.3782722588063,404.20641064892493],"yaxis":"y"},{"connectgaps":true,"fill":"tonexty","hovertemplate":"%{y}","legendgroup":"1","line":{"color":"deepskyblue","width":0.5},"name":"Lower bound","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[93.21068234010531,53.16346654343924,105.4805596761493,120.65851346649418,118.75441263563894,127.95141786344576,129.25703753010768,111.45327947582452,74.25300534956278,125.61463457399869,148.71590358372814,142.1845589321968,152.93850657913492,151.1777046857187,133.87018779697962,97.23935254174503,148.48807868131217,173.32784460677274,166.9760066651251,176.91157249581585,175.10135172996044,155.50088649417648,123.37192795361084,175.07180228381847,191.53559008622125,184.04232964339286,199.94525677213332,196.86419780704725,182.93582535996333,138.80048669774288,193.11607951926212,213.30142709972307,209.59006932739265,219.8172340928195,216.17716616866582,204.14243006010304,159.94505948985574,215.51038995460706,234.64009683264314,235.6585504608949,242.90200923338955,244.26897398095397,226.06607510365689,185.46256136855956,239.22322329869627,258.24151991430375,253.21923393801262,266.337303764881,265.5477530415665,248.69143936255765,209.81812446885607,263.4129223024699,282.1600621370265,279.77207124519697,283.934453557266,288.56371778968014,273.1057759559654,231.29909835230515,283.42109012859686,305.0293121524526,297.25710192522445,308.24847050178016,306.7882519818782,293.9080775293608,253.61262915563734,308.0650523342411,325.75370367429684,316.37955484496973,329.96471250537496,330.9175966397881,315.50843075144655,275.11598918971555,325.0077125523384,348.832840957433,342.70581018983404,354.912173869999,352.7687466367551,336.3256185226965,297.37031601108384,350.232608098913,369.67676037538826,364.40154537237777,375.7877386621752,376.6058564740985,362.6432093346778,320.41903835034805],"yaxis":"y"},{"connectgaps":true,"hovertemplate":"%{y}","legendgroup":"1","line":{"color":"red"},"name":"Actual","type":"scatter","x":["2020-01-02","2020-01-03","2020-01-04","2020-01-05","2020-01-06","2020-01-07","2020-01-08","2020-01-09","2020-01-10","2020-01-11","2020-01-12","2020-01-13","2020-01-14","2020-01-15","2020-01-16","2020-01-17","2020-01-18","2020-01-19","2020-01-20","2020-01-21","2020-01-22","2020-01-23","2020-01-24","2020-01-25","2020-01-26","2020-01-27","2020-01-28","2020-01-29","2020-01-30","2020-01-31","2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27"],"xaxis":"x","y":[126,76,169,198,175,137,155,128,134,161,179,184,211,191,160,139,174,185,204,237,236,197,183,213,236,234,245,256,224,176,240,301,276,282,262,229,161,264,285,233,285,257,285,227,272,292,324,321,307,353,232,304,284,286,281,355,300,206,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"yaxis":"y"}],"layout":{"height":600,"hovermode":"x","legend":{"groupclick":"toggleitem","orientation":"h","traceorder":"grouped","x":0,"y":-0.2},"shapes":[{"line":{"color":"white","dash":"dash","width":2},"type":"line","x0":"2020-02-28","x1":"2020-02-28","xref":"x","y0":0,"y1":1,"yref":"y domain"}],"template":{"data":{"bar":[{"error_x":{"color":"#f2f5fa"},"error_y":{"color":"#f2f5fa"},"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"rgb(17,17,17)","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"baxis":{"endlinecolor":"#A2B1C6","gridcolor":"#506784","linecolor":"#506784","minorgridcolor":"#506784","startlinecolor":"#A2B1C6"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"line":{"color":"#283442"}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"line":{"color":"#283442"}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#506784"},"line":{"color":"rgb(17,17,17)"}},"header":{"fill":{"color":"#2a3f5f"},"line":{"color":"rgb(17,17,17)"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#f2f5fa","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]],"sequentialminus":[[0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#f2f5fa"},"geo":{"bgcolor":"rgb(17,17,17)","lakecolor":"rgb(17,17,17)","landcolor":"rgb(17,17,17)","showlakes":true,"showland":true,"subunitcolor":"#506784"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"dark"},"paper_bgcolor":"rgb(17,17,17)","plot_bgcolor":"rgb(17,17,17)","polar":{"angularaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","radialaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"yaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"},"zaxis":{"backgroundcolor":"rgb(17,17,17)","gridcolor":"#506784","gridwidth":2,"linecolor":"#506784","showbackground":true,"ticks":"","zerolinecolor":"#C8D4E3"}},"shapedefaults":{"line":{"color":"#f2f5fa"}},"sliderdefaults":{"bgcolor":"#C8D4E3","bordercolor":"rgb(17,17,17)","borderwidth":1,"tickwidth":0},"ternary":{"aaxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"baxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""},"bgcolor":"rgb(17,17,17)","caxis":{"gridcolor":"#506784","linecolor":"#506784","ticks":""}},"title":{"x":0.05},"updatemenudefaults":{"bgcolor":"#506784","borderwidth":0},"xaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#283442","linecolor":"#506784","ticks":"","title":{"standoff":15},"zerolinecolor":"#283442","zerolinewidth":2}}},"title":{"text":"Accra Prognosis","x":0.5},"width":900,"xaxis":{"anchor":"y","domain":[0,1],"hoverformat":"%a, %b %d, %Y","title":{"text":"Date"}},"yaxis":{"anchor":"x","domain":[0,1],"title":{"text":"Orders, #"}}}});
</script>
<p>Several Notes:</p>
<ol>
<li>Lisbon:
<ol>
<li><strong>Valentine Day</strong>: Feb 14 was unusual day, my initial idea seems to be right based upon the cuisine which was specific to this date. The burgers which is the main cuisine were not so popular this day, but there were spikes for the meals for the group of people and &ldquo;romantic&rdquo; food, namely Japanese (Sushi) &amp; Italian (Pizza) as well as Breakfast, Ice Cream, Desserts</li>
<li><strong>Average Check</strong>: During the top weekdays in addition to orders number the average order values grows, not only more people order, but each person order more</li>
</ol>
</li>
<li>Accra:
<ol>
<li><strong>Delivered Percentage</strong>: first of all the delivered percentage for Accra is less than for Lisbon in general (statistical significance is checked below) and the second point is more accurate look at the dynamic, indeed there were some problems on Feb 7 (driver: ios failed) &amp; Feb 28 (driver: android rejected)</li>
<li><strong>Delivery Time</strong>: there is a positive trend in delivery time, one of the reasons can be the launch of the new suppliers, but it&rsquo;s impossible to check precisely using the given time frame only</li>
</ol>
</li>
</ol>
<h3 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h3>
<p><strong>Instead of Summary</strong>: If you don&rsquo;t have enough time, to go too much in detail (it doesn&rsquo;t mean that one can solve only well formulated problems, sometimes it only means that a person indeed doesn&rsquo;t have much time) use this high-level approach to explore you data and get immediate insights about your data structure; because after all arbitrarily amount of time can be spent on researching the data, but business never wants to wait.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Time Series Analysis in Python on twitter"
        href="https://twitter.com/intent/tweet/?text=Time%20Series%20Analysis%20in%20Python&amp;url=https%3a%2f%2fnpodlozhniy.github.io%2fposts%2ftimeseries-analysis%2f&amp;hashtags=">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Time Series Analysis in Python on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnpodlozhniy.github.io%2fposts%2ftimeseries-analysis%2f&amp;title=Time%20Series%20Analysis%20in%20Python&amp;summary=Time%20Series%20Analysis%20in%20Python&amp;source=https%3a%2f%2fnpodlozhniy.github.io%2fposts%2ftimeseries-analysis%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Time Series Analysis in Python on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnpodlozhniy.github.io%2fposts%2ftimeseries-analysis%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Time Series Analysis in Python on telegram"
        href="https://telegram.me/share/url?text=Time%20Series%20Analysis%20in%20Python&amp;url=https%3a%2f%2fnpodlozhniy.github.io%2fposts%2ftimeseries-analysis%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer><div id="disqus_thread"></div>
<script>
	
    var disqus_config = function () {
    this.page.url = 'https:\/\/npodlozhniy.github.io\/posts\/timeseries-analysis\/';  
    this.page.identifier = ''; 
	this.language = document.documentElement.lang; 
	};
 
    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://https-npodlozhniy-github-io-2.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
	
    document.addEventListener('theme-change', function(e) { 
		if (document.readyState == 'complete') {
			DISQUS.reset({ reload: true, config: disqus_config });
		}
	});

</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://npodlozhniy.github.io/">Nikita Podlozhniy</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }

		
		const event = new Event('theme-change');
		document.dispatchEvent(event)
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
